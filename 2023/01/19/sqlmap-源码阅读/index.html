<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Drunkbaby">
    
    <title>
        
            sqlmap 源码阅读 |
        
        Drunkbaby&#39;s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="https://raw.githubusercontent.com/Drun1baby/CVE_Pentest/main/%E5%8F%8B%E9%93%BEimages/favicon.png">
    
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/font/css/fontawesome.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/font/css/regular.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/font/css/solid.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/font/css/brands.min.css">
    
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"drun1baby.github.io","root":"/","language":"zh-CN","path":"search.xml"}
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":false,"init_open":true},"style":{"primary_color":"#0066cc","logo":"https://raw.githubusercontent.com/Drun1baby/CVE_Pentest/main/%E5%8F%8B%E9%93%BEimages/logo.png","favicon":"https://raw.githubusercontent.com/Drun1baby/CVE_Pentest/main/%E5%8F%8B%E9%93%BEimages/favicon.png","avatar":"https://raw.githubusercontent.com/Drun1baby/CVE_Pentest/main/%E5%8F%8B%E9%93%BEimages/favicon.png","font_size":"15px","font_family":null,"hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"header_transparent":true,"background_img":"/images/bg.svg","description":"且将新火试新茶，诗酒趁年华","font_color":null,"hitokoto":false},"scroll":{"progress_bar":true,"percent":false}},"local_search":{"enable":true,"preload":true},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default"},"side_tools":{},"pjax":{"enable":true},"lazyload":{"enable":false},"comment":{"enable":true,"use":"valine","valine":{"enable":true,"appid":"9Ky0YY6Ij33nFC4KZ2VcGh9k-MdYXbMMI","appkey":"qqN77H4k2Hxhg7ZJ88Lf0xxM","placeholder":"just go go","server_urls":"https://9Ky0YY6I.api.lncldglobal.com","background":"/images/comment_bg.png","count":true},"gitalk":{"github_id":"Drun1baby","github_admins":null,"repository":"gitalk-restore","client_id":"e5b5e5c0ba918eb3d3c4","client_secret":"a0ac0e6f2078095bce9291f42acd13b67e059dff","proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.8"},"waline":{"server_url":null,"reaction":false,"version":2}},"post":{"author_label":{"enable":true,"auto":true,"custom_label_list":["Trainee","Engineer","Architect"]},"word_count":{"enable":true,"wordcount":true,"min2read":true},"img_align":"left","copyright_info":true},"website_count":{"busuanzi_count":{"enable":true,"site_uv":true,"site_pv":true,"page_pv":true}},"version":"3.7.3"}
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"}
    KEEP.language_code_block = {"copy":"复制代码","copied":"已复制","fold":"折叠代码块","folded":"已折叠"}
    KEEP.language_copy_copyright = {"copy":"复制版权信息","copied":"已复制","title":"原文标题","author":"原文作者","link":"原文链接"}
  </script>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Drunkbaby's Blog" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>


<main class="page-container border-box">

    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="https://raw.githubusercontent.com/Drun1baby/CVE_Pentest/main/%E5%8F%8B%E9%93%BEimages/logo.png">
                </a>
            
            <a class="site-name border-box" href="/">
               Drunkbaby&#39;s Blog
            </a>
        </div>

        <div class="right border-box">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/links"
                            >
                                友链
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                关于
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/links">友链</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">关于</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">

                

                    <div class="fade-in-down-animation">
    <div class="post-page-container border-box">

        <div class="article-content-container border-box">

            <div class="article-title">
                <span class="title-hover-animation">sqlmap 源码阅读</span>
            </div>

            
                <div class="article-header border-box">
                    
                        <div class="avatar-box border-box">
                            <img src="https://raw.githubusercontent.com/Drun1baby/CVE_Pentest/main/%E5%8F%8B%E9%93%BEimages/favicon.png">
                        </div>
                    
                    <div class="info-box">
                        <div class="author">
                            <span class="name">Drunkbaby</span>
                            
                                <span class="author-label">Lv6</span>
                            
                        </div>
                        <div class="meta-info border-box">
                            

<div class="article-meta-info-container border-box post">
    <div class="article-meta-info border-box">
        


        
            <span class="meta-info-item article-create-date">
                <i class="icon fa-solid fa-calendar-check"></i>&nbsp;
                <span class="pc">2023-01-19 20:45:19</span>
                <span class="mobile">2023-01-19 20:45</span>
            </span>

            <span class="meta-info-item article-update-date">
                <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                <span class="pc">2023-03-29 22:04:44</span>
            </span>
        

        
            <span class="meta-info-item article-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul>
                    
                            <li class="category-item">
                                
                                <a href="/categories/%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91-%E7%BC%96%E5%86%99/">工具开发&amp;编写</a>
                            </li>
                        
                    
                </ul>
            </span>
        

        
            <span class="article-tag meta-info-item border-box">
                <i class="icon fas fa-tags"></i>&nbsp;
                <ul>
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91-%E7%BC%96%E5%86%99/">工具开发&amp;编写</a></li>
                        
                    
                </ul>
            </span>
        

        
        
            <span class="meta-info-item article-wordcount">
                <i class="icon fas fa-file-word"></i>&nbsp;<span>4k 字</span>
            </span>
        
        
            <span class="meta-info-item article-min2read">
                <i class="icon fas fa-clock"></i>&nbsp;<span>15 分钟</span>
            </span>
        
        
            <span class="meta-info-item article-pv">
                <i class="icon fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
            </span>
        
    </div>

    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content keep-markdown-body">
                

                <p>sqlmap 源码阅读</p>
<span id="more"></span>
<h2 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a>0x01 前言</h2><p>还是代码功底太差，所以想尝试阅读 sqlmap 源码一下，并且自己用 golang 重构，到后面会进行 ysoserial 的改写；以及 xray 的重构，当然那个应该会很多参考 cel-go 项目</p>
<h2 id="0x02-环境准备"><a href="#0x02-环境准备" class="headerlink" title="0x02 环境准备"></a>0x02 环境准备</h2><p>sqlmap 的项目地址：<a class="link"   target="_blank" rel="noopener" href="https://github.com/sqlmapproject/sqlmap" >https://github.com/sqlmapproject/sqlmap<i class="fas fa-external-link-alt"></i></a><br>用 pycharm 打断点调试，因为 vscode 用来调试比较麻烦。</p>
<p>因为要动调，所以需要一个 sql 注入的靶场，这里直接选用的是 sql-labs，用 docker 起</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull acgpiano/sqli-labs</span><br><span class="line">docker run -dt --name sqli-lab -p [PORT]:80 acgpiano/sqli-labs:latest</span><br></pre></td></tr></table></figure>

<p>最后还需要重新配置一下数据库，然后才能以 sqli-labs 为靶场进行测试。</p>
<p>这里也挂一下 sqlmap 对应的一些基础操作 ———— <a class="link"   target="_blank" rel="noopener" href="https://www.cnblogs.com/hongfei/p/3872156.html" >https://www.cnblogs.com/hongfei/p/3872156.html<i class="fas fa-external-link-alt"></i></a></p>


<p>直接在 pycharm 的 Debug 下进行调试，设置参数如下，开始调试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-u <span class="string">&quot;http://81.68.120.14:3333/Less-1/?id=1&quot;</span> -technique=E --dbs</span><br></pre></td></tr></table></figure>

<h2 id="0x03-sqlmap-源码阅读"><a href="#0x03-sqlmap-源码阅读" class="headerlink" title="0x03 sqlmap 源码阅读"></a>0x03 sqlmap 源码阅读</h2><p>在开始之前我们有必要确认一下 <strong>sqlmap 运行的流程图</strong>，很重要！这样有助于我们进一步分析源码。</p>


<h3 id="1-初始化"><a href="#1-初始化" class="headerlink" title="1. 初始化"></a>1. 初始化</h3><p>在 <code>sqlmap.py</code> 的 main 函数下断点，开始调试</p>
<p>在没有对 URL 进行发包&#x2F;探测的时候 sqlmap 会先对一些环境、依赖、变量来做一些初始化的处理</p>


<p>往下，通过 <code>cmdLineParser()</code> 获取参数，<code>cmdLineParser()</code> 通过 <code>argparse</code> 库进行 CLI 的打印与获取，类似的一个小项目我之前也有接触过  <a class="link"   target="_blank" rel="noopener" href="https://github.com/Drun1baby/EasyScan" >https://github.com/Drun1baby/EasyScan<i class="fas fa-external-link-alt"></i></a></p>
<p>往下 <code>initOptions(cmdLineOptions)</code> 解析命令行参数</p>
<p><code>init</code> 函数： 初始化</p>
<p>在 <code>init()</code> 函数中通过调用各种函数进行参数的设置、payload 的加载等，有兴趣的师傅可以点进去阅读一下。</p>


<p>其中这三个相对比较重要，是用来加载 payload 的 ———— <code>loadBoundaries()</code>、<code>loadPayloads()</code>、<code>_loadQueries()</code>，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">loadBoundaries()  // 加载闭合符集合</span><br><span class="line">loadPayloads()    // 加载 payload 集合</span><br><span class="line">_loadQueries()    // 加载查询语句，在检测到注入点之后后续进行数据库库名字段名爆破会用到的语句</span><br></pre></td></tr></table></figure>

<p>下个断先点调试一下 <code>loadBoundaries()</code> 函数</p>


<p>首先，会去加载 <code>paths.BOUNDARIES_XML</code>，也就是 <code>data/xml/boundaries.xml</code></p>


<p>接着进入解析 XML 文件的部分，跟进 <code>parseXmlNode(root)</code></p>


<p>最终添加到 conf 对象的 tests 属性里</p>


<ul>
<li><code>loadPayloads()</code> 函数与 <code>_loadQueries()</code> 函数大体上也是如此，都是做了解析 xml 文件的工作，再将内容保存到 conf 对象的 tests 属性里。像 <code>loadPayloads()</code> 函数，最后在 <code>conf.tests</code> 里面可以很清晰的看到 payloads</li>
</ul>


<p>此时我们还可以看一下 <code>conf</code> 是什么</p>


<p>conf 属性中主要存储了一些目标的相关信息（hostname、path、请求参数等等）以及一些配置信息，init 加载的 payload、请求头 header、cookie 等</p>
<p><code>init()</code> 函数执行完毕后，就会来到 <code>start()</code> 函数进行项目的正式运行。</p>


<h5 id="初始化功能点小结"><a href="#初始化功能点小结" class="headerlink" title="初始化功能点小结"></a>初始化功能点小结</h5><blockquote>
<p>简单概括一下初始化部分的代码做了什么事</p>
</blockquote>
<ul>
<li>获取命令行参数并处理</li>
<li>初始化全局变量 conf 以及 kb</li>
<li>获取并解析几个 xml 文件，完成闭合工作、payloads 加载工作</li>
<li>设置 HTTP 相关配置，如 HTTP Header，UA，Session 等</li>
</ul>
<h3 id="2-URL-处理"><a href="#2-URL-处理" class="headerlink" title="2. URL 处理"></a>2. URL 处理</h3><p>f8 下来，先到的是 <code>threadData = getCurrentThreadData()</code>，继续往下走，到 <code>result = f(*args, **kwargs)</code> 代码块，跟进一下</p>


<p>代码逻辑此时来到了 <code>/lib/controller/controller.py</code> 下，往下走，是不会进到 <code>conf.direct</code> 和 <code>conf.hashFile</code> 中的，会直接进入到 <code>kb.targets.add()</code> 的代码逻辑里面。</p>


<p>此处的 kb 变量的作用是共享一些对象，其实本质上是保存了注入时的一些参数。<code>kb.targets</code> 添加了我们输入的参数，如图</p>


<p>往下看，大体上是做了一些类似类似打印日志、赋值、添加 HTTP Header 等工作，这一部分代码我们就不看了，直接看最关键的这一部分代码 <code>parseTargetUrl()</code>。</p>


<p>跟进</p>


<p>一开始先进行了这一判断</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> re.search(<span class="string">r&quot;://\[.+\]&quot;</span>, conf.url) <span class="keyword">and</span> <span class="keyword">not</span> socket.has_ipv6</span><br></pre></td></tr></table></figure>

<p>判断 <code>http://</code> 的开头形式是否正确，以及 socket 是否为 ipv6 协议，如果为 ipv6 协议，那么 sqlmap 并不支持。</p>
<p>接着判断</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> re.search(<span class="string">r&quot;^(http|ws)s?://&quot;</span>, conf.url, re.I):</span><br></pre></td></tr></table></figure>

<p>判断是 http 开头还是 https 开头，又或者是否是 ws&#x2F;wss 开头，如果没有这些开头，则就从端口判断，这里我认为或许可以加上 80 与 8080 端口。</p>


<p>继续往下看，进行了 url 的拆分、host 的拆分，并将这些内容保存到 conf 里面的对应属性，后续也是一些基础的判断与赋值，这里不再赘述。</p>


<blockquote>
<p>总而言之是在对 URL 进行剖析与拆解，最后这些东西都是放到 <code>conf</code> 里面的</p>
</blockquote>
<h3 id="3-如果这个网站已经被注入过，生成注入检测的payload"><a href="#3-如果这个网站已经被注入过，生成注入检测的payload" class="headerlink" title="3. 如果这个网站已经被注入过，生成注入检测的payload"></a>3. 如果这个网站已经被注入过，生成注入检测的payload</h3><p>核心代码在 <code>controller.py</code> 的第 434 行，需跟进；此处我们可以设置对 <code>kb.injections</code> 的变量监测。先跟进 <code>setupTargetEnv()</code> 函数</p>


<ul>
<li><code>setupTargetEnv()</code> 函数调用了如下图所示的七个函数</li>
</ul>


<p>我们跟进最主要的 <code>_resumeHashDBValues()</code> 函数，首先调用了 <code>hashDBRetrieve()</code> 函数，设置检索</p>


<p>出来，到第 476 行，这一次又调用了 <code>hashDBRetrieve()</code> 函数，传参是 <code>HASHDB_KEYS.KB_INJECTIONS</code>，意思就是以 <code>KB_INJECTIONS</code> 作为 KEY 进行检索。跟进发现函数先将需要注入的 URL 信息放到了 <code>_</code><br>这个变量中，并将基础信息用 <code>|</code> 符号隔开。</p>


<p>跟进 <code>retrieve()</code> 函数，这个函数做了生成 payload 的工作，具体是怎么生成的我们继续往下看</p>


<p>第 95 行，这里很重要，执行了 SQL 语句，并通过 Hash 加密，加密方式是 base64Pickle 序列化</p>


<p>最终反序列化解密 Payload，说实话这里没看懂是怎么生成的，看上去仅仅是执行了一个 SQL 语句，后面看其他师傅的文章的时候并没有把这一段单独拉出来说，payloads 其实都放在 xml 当中。</p>


<p>接着再循环一次，生成一个 payload</p>
<p>在生成完所有 payload 之后会先对目标进行一次探测，如果 Connection refused 则返回 False</p>


<p>这里生成的 payload 只是很基础的一部分，并非是</p>
<h3 id="4-WAF-检测"><a href="#4-WAF-检测" class="headerlink" title="4. WAF 检测"></a>4. WAF 检测</h3><p>解析完 URL 之后对目标进行探测，往下看，位置是 <code>controller.py</code> 的第 439 行，第 448 行有 <code>checkWaf()</code> 的函数，很明显就是要做 WAF 检测的功能。</p>


<p>先会判断这一目标是否存在 WAF，如果存在 WAF 的话，会进行字符的相关 fuzz，当然此处建议对一个存在 WAF 的目标进行测试。值得注意的是，如果这个目标你已经探测过存在 waf，且已知 waf 归属厂商的情况下，就不会走到 payload 那一段代码逻辑当中去，相关的业务代码在 <code>hashDBRetrieve()</code> 下，此处不再展开，比较容易。</p>


<p>如果存在 WAF，则会生成用于 fuzz 的 payload，这个 payload 是基于这个 NMAP 的 <code>http-waf-detect.nse</code> ———— <a class="link"   target="_blank" rel="noopener" href="https://seclists.org/nmap-dev/2011/q2/att-1005/http-waf-detect.nse" >https://seclists.org/nmap-dev/2011/q2/att-1005/http-waf-detect.nse<i class="fas fa-external-link-alt"></i></a></p>
<p>设置 payload 类似于 <code>&quot;9283 AND 1=1 UNION ALL SELECT 1,NULL,&#39;&lt;script&gt;alert(&quot;XSS&quot;)&lt;/script&gt;&#39;,table_name FROM information_schema.tables WHERE 2&gt;1--/**/; EXEC xp_cmdshell(&#39;cat ../../../etc/passwd&#39;)#&quot;</code>，如果没有 WAF，页面不会变化，如果有 WAF，因为 payload 中有很多敏感字符，大多数时候页面都会发生改变。</p>
<p>接下来的 <code>conf.identifyWaf</code> 代表 sqlmap 的参数 <code>--identify-waf</code>,如果指定了此参数，就会进入 <code>identifyWaf()</code> 函数，主要检测的 waf 都在 sqlmap 的 waf 目录下。不过新版的 sqlmap 已经将这一参数的功能自动放到里面了，无需再指定参数</p>
<ul>
<li>这里的 payload 先经过处理后赋值给 value，再将 value 作为参数传入 <code>queryPage()</code> 请求中，跟进</li>
</ul>


<p>在经过很长一段的数据处理与判断代码后，我们到第 1531 行，如图，跟进；<code>getPage()</code> 函数的作用是获取界面的一些信息，如 url，ua，host 等，通过输出比对 payload，为判断 waf 类型提供信息。</p>


<ul>
<li>获取基本信息</li>
</ul>


<p>这些基础信息最后都会保存在 response 系列的 message 当中</p>


<p><code>getPage()</code> 函数中调用了 <code>processResponse()</code> 函数做响应结果的处理，跟进</p>


<p>往下看，到 401 行开始，后续的代码进行了 Waf 的识别</p>


<p>跟进 <code>identYwaf.non_blind_check()</code>，是通过正则表达式来对页面进行匹配，对应的规则在 <code>thirdparty/identywaf/data.json</code> 中</p>




<p>同时 sqlmap 不光通过规则库来进行判断，也会通过页面相似度来判断是否存在 <code>waf/ips</code></p>


<p>如果相似度小于设定的 0.5 那么就判定为有 waf 拦截</p>


<h4 id="WAF-注入总结"><a href="#WAF-注入总结" class="headerlink" title="WAF 注入总结"></a>WAF 注入总结</h4><p>总结一下就是两点，一种方法是通过正则匹配的检测，另外一种方法是根据页面相似度来检测，我自己应该很难写出来 waf 检测的东西；届时再做尝试。</p>
<h3 id="5-注入检测之启发式注入"><a href="#5-注入检测之启发式注入" class="headerlink" title="5. 注入检测之启发式注入"></a>5. 注入检测之启发式注入</h3><p>从 <code>checkWaf()</code>  函数里面出来，先到第 457 行，检测网站是否稳定（因为有些网站一测试可能就炸了）对应此 info</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[INFO] testing if the target URL content is stable</span><br></pre></td></tr></table></figure>



<p>继续往下走到第 471 行，会先判断参数是否可以注入，这里与命令的参数 —— <code>--level</code> 挂钩</p>


<p>在前文环境准备的时候我们采用的方式是报错注入，如果不这么做，直接指定参数 <code>--dbs</code>，无法进入到启发式注入里面。我们接着看代码，往下直到第 581 行，调用的 <code>heuristicCheckSqlInjection()</code> 函数，意思是启发性注入。</p>


<ul>
<li>启发式注入做了哪些工作</li>
</ul>
<p>1、<strong>数据库版本的识别</strong><br>2、<strong>绝对路径获取</strong><br>3、<strong>XSS 的测试</strong></p>
<h4 id="数据库版本的识别"><a href="#数据库版本的识别" class="headerlink" title="数据库版本的识别"></a>数据库版本的识别</h4><p>首先会从 <code>HEURISTIC_CHECK_ALPHABET</code> 中随机抽取10个字符出现构造 Payload，当然里面的都不是些普通的字符，而且些特殊字符，当我们进行 SQL 注入测试的时候会很习惯的在参数后面加个分号啊什么的，又或者是其他一些特殊的字符，出现运气好的话有可能会暴出数据的相关错误信息，而那个时候我们就可以根据所暴出的相关错误信息去猜测当前目标的数据库是什么。</p>
<p>并且最后生成的这个 payload 是能够闭合的</p>


<p>实际找个网站测试，如图，这就是报出的 SQL 数据库错误</p>


<p>判断在 <code>lib/request/connect.py</code> 的 1532 行</p>


<p>接着跟进 <code>processResponse()</code> 函数，这里和 waf 对比用的同一种方式，不再详细说明</p>


<p>其中 <code>processResponse()</code> 会调用到 <code>./lib/parse/html.py</code> 中的 <code>htmlParser()</code> 函数，这一个函数就是根据不同的数据库指纹去识别当前的数据库究竟是什么。</p>




<p>最终实现这一功能的其实是 <code>HTMLHandler</code> 这个类，<code>errors.xml</code> 文件内容如图</p>


<p>这一配置文件的比较简单，其实也就是一些对应数据库的正则。sqlmap 在解析 <code>errors.xml</code> 的时候，然后根据 <code>regexp</code> 中的正则去匹配当前的页面信息然后去确定当前的数据库。这一步和 WAF 比对类似。</p>
<p>到此 sqlmap 就可以确定数据的版本了，从而选择对应的测试 Payload，后续我们会看到这是根据莫索引将 payloads 排序，然后选取对应数据库信息的 payloads 进行测试。减少 sqlmap 的扫描时间。</p>
<ul>
<li>最后这个 DBMS 探测对应的是这一段信息</li>
</ul>


<h4 id="获取绝对路径与-XSS-探测"><a href="#获取绝对路径与-XSS-探测" class="headerlink" title="获取绝对路径与 XSS 探测"></a>获取绝对路径与 XSS 探测</h4><p>相比指纹识别，获取绝对路径的功能模块相对简单，利用正则匹配寻找出绝对路径。</p>


<p>XSS 的探测也比较简单，这里就不作代码分析了</p>


<h3 id="6-注入检测之正式注入"><a href="#6-注入检测之正式注入" class="headerlink" title="6. 注入检测之正式注入"></a>6. 注入检测之正式注入</h3><p>从启发式注入里面出来，到第 592 行，进行正式的注入检测，跟进</p>


<p>到第 130 行，获取所有的 payload，后续会根据数据库的信息构建索引，将符合索引的 payload 拿去攻击</p>


<p>往下走，先判断有没有做数据库信息的获取，如果有则跳过，如果没有就先进行上一步的启发式注入</p>


<p>接着根据通过报错得到的数据库信息建立索引，将对应最有效的 payload 拿出来。这些 payloads 会进行 while 循环</p>


<p>第 370 行，通过 <code>cleanupPayload()</code> 函数对 payload 进行处理，主要功能其实是做了 payload 的标签替换</p>


<p>最后替换过的 payload 长这样</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;AND (SELECT 2*(IF((SELECT * FROM (SELECT CONCAT(&#x27;qbpxq&#x27;,(SELECT (ELT(9125=9125,1))),&#x27;qxkvq&#x27;,&#x27;x&#x27;))s), 8446744073709551610, 8446744073709551610)))&quot;</span></span><br></pre></td></tr></table></figure>

<p>在 sqlmap 中将payload 分为了三部分，上面生成的 fstpayload 就是中间那部分</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prefix + payload + suffix </span><br></pre></td></tr></table></figure>

<p>prefix 和 suffix 就是对应的，闭合前面的结合以及注释后面的结构，这两个属性主要是从 boundary 中进行获取的，boundary 就是前面加载的 <code>boundaries.xml</code> 配置文件，用来闭合的，所以这里作为了 prefix 和 suffix</p>


<p>最后的拼接</p>


<p>并分别对 prefix 和 suffix 进行 clean，然后进行组合，组合之后的 payload 就是 reqPayload，然后进行请求</p>


<ul>
<li>发出请求最终还是通过 <code>request.queryPage()</code> 来实现的</li>
</ul>
<p>请求完毕的结果经过 <code>queryPage()</code> 函数来获取界面，但是页面结果是由 <code>kb.chars.start</code> 和 <code>kb.chars.stop</code> 包裹着的</p>




<p>当第一次的注入不成功的时候，会不断变更 prefix，suffix，当 prefix 和 suffix 都变更完毕但还是无法注入时，才会变更 payload，取出另一个 payload 出来，直至 <code>injectable</code> 变量为 true，同时 <code>output=1</code></p>


<p>并且 <code>injectable=true</code></p>


<h3 id="7-爆数据库等操作"><a href="#7-爆数据库等操作" class="headerlink" title="7. 爆数据库等操作"></a>7. 爆数据库等操作</h3><p>经过上一步正式注入的判断，得到的 <code>injectable=true</code> 参数，才能进行下一步的爆数据库操作.</p>
<p>爆库阶段主要是先经过四个函数处理数据后，再调用 <code>action()</code> 函数，跟进。</p>


<p>这里已爆库为例，先看 <code>--dbs</code> 参数有关的这一块，核心函数是 <code>getDbs()</code></p>


<p>先根据后台数据库信息，输出日志</p>


<p>第 133 行，<code>queries</code> 就是存放之前初始化 <code>queries.xml</code> 的变量</p>


<p>首先通过 <code>count(schema_name)</code> 来获取数据库的个数，然后再通过 <code>limit num,1</code> 来依次获取数据库名，从 <code>queries</code> 变量中获取语句之后就会传递到 <code>getValue</code> 函数</p>


<p>跟进，前面做了一些基础的设置和 payload 的处理与赋值，比如第 401 行的 <code>cleanQuery()</code> 函数，将语句转换为大写，这里我就不跟进了。直接看关键语句，第 451 行，<code>errorUse()</code> 函数</p>


<p>在 <code>errorUse()</code> 中首先通过正则将 payload 中的各个部分都进行了获取 ，保存到了对应的 <code>field</code> 当中，最终经过一系列处理，取出了 payload 中的 <code>schema_name</code></p>


<p>跳出 <code>getFields()</code> 函数，往下，将 <code>expression</code> 的值经过 replace 操作，赋值给了 <code>countedExpression</code>，最终得到的值是 <code>&#39;SELECT COUNT(schema_name) FROM INFORMATION_SCHEMA.SCHEMATA&#39;</code></p>


<p>第 337 行，跟进 <code>_oneShotErrorUse()</code> 函数，在这一个函数中，sqlmap 对目标网站发包，使用的 payload 为 <code>countedExpression</code>，目的是探测数据库个数（count）</p>


<p>具体业务发包在这里</p>


<p>最后将结果传入 <code>extractRegexResult()</code> 函数中进行正则提取</p>


<p>多线程的方式进行注入，而 <code>runThreads()</code> 函数调用了 <code>errorThread()</code> 函数，最终的注入业务还是由 <code>errorThread()</code> 函数来完成的</p>




<p>跟进一下 <code>_errorFields()</code> 函数，将每一个表进行 while 循环操作，再通过 <code>limitQuery()</code> 函数设置最后的 <code>Limit</code> 语句</p>


<p>最后成功 <code>--dbs</code></p>


<blockquote>
<p>sqlmap 流程分析结束</p>
</blockquote>
<h2 id="0x04-小结"><a href="#0x04-小结" class="headerlink" title="0x04 小结"></a>0x04 小结</h2><p>sqlmap 的流程分析需要非常重视这张图，当感觉代码看不下去的时候看一下这张图可以事半功倍。</p>


<p>在审计开始之前也可以看一下 <code>utils</code> 文件夹下的 python 文件，总体来说流程并不难，看正则的时候其实挺吃力的。</p>
<h2 id="0x05-Reference"><a href="#0x05-Reference" class="headerlink" title="0x05 Reference"></a>0x05 Reference</h2><p><a class="link"   target="_blank" rel="noopener" href="http://wjlshare.com/archives/1733" >http://wjlshare.com/archives/1733<i class="fas fa-external-link-alt"></i></a><br><a class="link"   target="_blank" rel="noopener" href="https://wooyun.js.org/drops/SQLMAP%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90Part1.%E6%B5%81%E7%A8%8B%E7%AF%87.html" >https://wooyun.js.org/drops/SQLMAP%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90Part1.%E6%B5%81%E7%A8%8B%E7%AF%87.html<i class="fas fa-external-link-alt"></i></a></p>

            </div>

            
                <div class="post-copyright-info">
                    
<div class="article-copyright-info-container">
    <ul class="copyright-info-content">
        <li class="post-title">
            <span class="type">本文标题</span>：<span class="content">sqlmap 源码阅读</span>
        </li>
        <li class="post-author">
            <span class="type">本文作者</span>：<span class="content">Drunkbaby</span>
        </li>
        <li class="post-time">
            <span class="type">创建时间</span>：<span class="content">2023-01-19 20:45:19</span>
        </li>
        <li class="post-link">
            <span class="type">本文链接</span>：<span class="content">2023/01/19/sqlmap-源码阅读/</span>
        </li>
        <li class="post-license">
            <span class="type">版权声明</span>：<span class="content">本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！</span>
        </li>
    </ul>
    <div class="copy-copyright-info flex-center tooltip" data-content="复制版权信息" data-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91-%E7%BC%96%E5%86%99/"><i class="icon fas fa-hashtag"></i>工具开发&amp;编写</a>&nbsp;
                        </li>
                    
                </ul>
            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                               rel="prev"
                               href="/2023/02/09/CVE-2017-10271-WebLogic-XMLDecoder/"
                            >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                                <span class="title flex-center">
                                <span class="post-nav-title-item text-ellipsis">CVE-2017-10271 WebLogic XMLDecoder</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                               rel="next"
                               href="/2023/01/13/MySQL-jdbc-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90/"
                            >
                            <span class="title flex-center">
                                <span class="post-nav-title-item text-ellipsis">MySQL jdbc 反序列化分析</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                                <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                            </a>
                        </div>
                    
                </div>
            

            
                


    <div class="comments-container">
        <div id="comments-anchor"></div>
        <div class="comment-area-title">
            <i class="fas fa-comments"></i>&nbsp;评论
        </div>
        
            

    <div class="valine-container">
        <script data-pjax src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
          function loadValine() {

            const config = {
              el: '#vcomments',
              appId: '9Ky0YY6Ij33nFC4KZ2VcGh9k-MdYXbMMI',
              appKey: 'qqN77H4k2Hxhg7ZJ88Lf0xxM',
              meta: ['nick', 'mail', 'link'],
              avatar: 'wavatar',
              enableQQ: true,
              placeholder: 'just go go',
              lang: 'zh-CN'.toLowerCase()
            }

            if ('https://9Ky0YY6I.api.lncldglobal.com') {
              config.serverURLs = 'https://9Ky0YY6I.api.lncldglobal.com'
            }

            new Valine(config)

            function getAuthor(language) {
              switch (language) {
                case 'en':
                  return 'Author'
                case 'zh-CN':
                  return '博主'
                case 'zh-TW':
                  return '站長'
                default:
                  return 'Master'
              }
            }

            // Add "Author" identify
            const getValineDomTimer = setInterval(() => {
              const vcards = document.querySelectorAll('#vcomments .vcards .vcard')
              if (vcards.length > 0) {
                let author = 'Drunkbaby'

                if (author) {
                  for (let vcard of vcards) {
                    const vnick_dom = vcard.querySelector('.vhead .vnick')
                    const vnick = vnick_dom.innerHTML
                    if (vnick === author) {
                      vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                    }
                  }
                }
                clearInterval(getValineDomTimer)
              } else {
                clearInterval(getValineDomTimer)
              }
            }, 2000)
          }

          if ('true' === 'true') {
            const loadValineTimeout = setTimeout(() => {
              loadValine()
              clearTimeout(loadValineTimeout)
            }, 1000)
          } else {
            window.addEventListener('DOMContentLoaded', loadValine)
          }
        </script>
    </div>


        
    </div>





            
        </div>

        
            <div class="pc-post-toc right-toc">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-%E5%89%8D%E8%A8%80"><span class="nav-text">0x01 前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x02-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="nav-text">0x02 环境准备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x03-sqlmap-%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB"><span class="nav-text">0x03 sqlmap 源码阅读</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-text">1. 初始化</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8A%9F%E8%83%BD%E7%82%B9%E5%B0%8F%E7%BB%93"><span class="nav-text">初始化功能点小结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-URL-%E5%A4%84%E7%90%86"><span class="nav-text">2. URL 处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%A6%82%E6%9E%9C%E8%BF%99%E4%B8%AA%E7%BD%91%E7%AB%99%E5%B7%B2%E7%BB%8F%E8%A2%AB%E6%B3%A8%E5%85%A5%E8%BF%87%EF%BC%8C%E7%94%9F%E6%88%90%E6%B3%A8%E5%85%A5%E6%A3%80%E6%B5%8B%E7%9A%84payload"><span class="nav-text">3. 如果这个网站已经被注入过，生成注入检测的payload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-WAF-%E6%A3%80%E6%B5%8B"><span class="nav-text">4. WAF 检测</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#WAF-%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93"><span class="nav-text">WAF 注入总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%B3%A8%E5%85%A5%E6%A3%80%E6%B5%8B%E4%B9%8B%E5%90%AF%E5%8F%91%E5%BC%8F%E6%B3%A8%E5%85%A5"><span class="nav-text">5. 注入检测之启发式注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC%E7%9A%84%E8%AF%86%E5%88%AB"><span class="nav-text">数据库版本的识别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84%E4%B8%8E-XSS-%E6%8E%A2%E6%B5%8B"><span class="nav-text">获取绝对路径与 XSS 探测</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E6%B3%A8%E5%85%A5%E6%A3%80%E6%B5%8B%E4%B9%8B%E6%AD%A3%E5%BC%8F%E6%B3%A8%E5%85%A5"><span class="nav-text">6. 注入检测之正式注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E7%88%86%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AD%89%E6%93%8D%E4%BD%9C"><span class="nav-text">7. 爆数据库等操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x04-%E5%B0%8F%E7%BB%93"><span class="nav-text">0x04 小结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x05-Reference"><span class="nav-text">0x05 Reference</span></a></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="border-box website-info-box default">
        
            <div class="copyright-info info-item default">
                &copy;&nbsp;<span>2021</span>&nbsp;-&nbsp;2023
                
                    &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">Drunkbaby</a>
                
            </div>

            <div class="theme-info info-item default">
                由&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.7.3</a>
            </div>

            

            
        

        <div class="count-item info-item default">
            

            
                <span class="count-box border-box uv">
                    <span class="item-type border-box">访问人数</span>
                    <span class="item-value border-box uv" id="busuanzi_value_site_uv"></span>
                </span>
            

            
                <span class="count-box border-box pv">
                    <span class="item-type border-box">总访问量</span>
                    <span class="item-value border-box pv" id="busuanzi_value_site_pv"></span>
                </span>
            
        </div>
    </div>
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="tools-list border-box">
        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        
            <li class="tools-item flex-center go-to-comments">
                <i class="fas fa-comment"></i>
                <span class="post-comments-count"></span>
            </li>
        
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        
            <li class="tools-item go-to-comments-tablet flex-center">
                <i class="fas fa-comment"></i>
            </li>
        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-%E5%89%8D%E8%A8%80"><span class="nav-text">0x01 前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x02-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="nav-text">0x02 环境准备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x03-sqlmap-%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB"><span class="nav-text">0x03 sqlmap 源码阅读</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-text">1. 初始化</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8A%9F%E8%83%BD%E7%82%B9%E5%B0%8F%E7%BB%93"><span class="nav-text">初始化功能点小结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-URL-%E5%A4%84%E7%90%86"><span class="nav-text">2. URL 处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%A6%82%E6%9E%9C%E8%BF%99%E4%B8%AA%E7%BD%91%E7%AB%99%E5%B7%B2%E7%BB%8F%E8%A2%AB%E6%B3%A8%E5%85%A5%E8%BF%87%EF%BC%8C%E7%94%9F%E6%88%90%E6%B3%A8%E5%85%A5%E6%A3%80%E6%B5%8B%E7%9A%84payload"><span class="nav-text">3. 如果这个网站已经被注入过，生成注入检测的payload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-WAF-%E6%A3%80%E6%B5%8B"><span class="nav-text">4. WAF 检测</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#WAF-%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93"><span class="nav-text">WAF 注入总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%B3%A8%E5%85%A5%E6%A3%80%E6%B5%8B%E4%B9%8B%E5%90%AF%E5%8F%91%E5%BC%8F%E6%B3%A8%E5%85%A5"><span class="nav-text">5. 注入检测之启发式注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC%E7%9A%84%E8%AF%86%E5%88%AB"><span class="nav-text">数据库版本的识别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84%E4%B8%8E-XSS-%E6%8E%A2%E6%B5%8B"><span class="nav-text">获取绝对路径与 XSS 探测</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E6%B3%A8%E5%85%A5%E6%A3%80%E6%B5%8B%E4%B9%8B%E6%AD%A3%E5%BC%8F%E6%B3%A8%E5%85%A5"><span class="nav-text">6. 注入检测之正式注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E7%88%86%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AD%89%E6%93%8D%E4%BD%9C"><span class="nav-text">7. 爆数据库等操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x04-%E5%B0%8F%E7%BB%93"><span class="nav-text">0x04 小结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x05-Reference"><span class="nav-text">0x05 Reference</span></a></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/dark-light-toggle.js"></script>




    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/code-block.js"></script>




<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/post-helper.js"></script>
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/libs/anime.min.js"></script>
        
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/toc.js"></script>
        
    
    
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>




</body>
</html>
