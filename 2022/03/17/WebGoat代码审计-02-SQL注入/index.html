<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Drunkbaby">
    
    <title>
        
            WebGoat代码审计-02-SQL注入 |
        
        Drunkbaby&#39;s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/avatar.svg">
    
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/font/css/fontawesome.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/font/css/regular.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/font/css/solid.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/font/css/brands.min.css">
    
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"drun1baby.github.io","root":"/","language":"zh-CN","path":"search.xml"}
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":false,"init_open":true},"style":{"primary_color":"#0066cc","logo":"/images/logo.svg","favicon":"/images/avatar.svg","avatar":"/images/avatar.svg","font_size":"15px","font_family":null,"hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"header_transparent":true,"background_img":"/images/bg.svg","description":"且将新火试新茶，诗酒趁年华","font_color":null,"hitokoto":false},"scroll":{"progress_bar":true,"percent":false}},"local_search":{"enable":true,"preload":true},"code_block":{"tools":{"enable":true,"style":"mac"},"highlight_theme":"default"},"side_tools":{},"pjax":{"enable":true},"lazyload":{"enable":false},"comment":{"enable":true,"use":"valine","valine":{"enable":true,"appid":"mCIu9X4iLP3I0GikUoetB9bV-9Nh9j0Va","appkey":"ermlV1eoB1YODT088EdXjo6C","placeholder":"just go go","background":"/images/comment_bg.png","count":true},"gitalk":{"github_id":"Drun1baby","github_admins":null,"repository":"gitalk-restore","client_id":"e5b5e5c0ba918eb3d3c4","client_secret":"a0ac0e6f2078095bce9291f42acd13b67e059dff","proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.8"},"waline":{"server_url":null,"reaction":false,"version":2}},"post":{"author_label":{"enable":true,"auto":true,"custom_label_list":["Trainee","Engineer","Architect"]},"word_count":{"enable":true,"wordcount":true,"min2read":true},"img_align":"left","copyright_info":true},"website_count":{"busuanzi_count":{"enable":true,"site_uv":true,"site_pv":true,"page_pv":true}},"version":"3.7.3"}
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"}
    KEEP.language_code_block = {"copy":"复制代码","copied":"已复制","fold":"折叠代码块","folded":"已折叠"}
    KEEP.language_copy_copyright = {"copy":"复制版权信息","copied":"已复制","title":"原文标题","author":"原文作者","link":"原文链接"}
  </script>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Drunkbaby's Blog" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>


<main class="page-container border-box">

    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/logo.svg">
                </a>
            
            <a class="site-name border-box" href="/">
               Drunkbaby&#39;s Blog
            </a>
        </div>

        <div class="right border-box">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/links"
                            >
                                友链
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                关于
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/links">友链</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">关于</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">

                

                    <div class="fade-in-down-animation">
    <div class="post-page-container border-box">

        <div class="article-content-container border-box">

            <div class="article-title">
                <span class="title-hover-animation">WebGoat代码审计-02-SQL注入</span>
            </div>

            
                <div class="article-header border-box">
                    
                        <div class="avatar-box border-box">
                            <img src="/images/avatar.svg">
                        </div>
                    
                    <div class="info-box">
                        <div class="author">
                            <span class="name">Drunkbaby</span>
                            
                                <span class="author-label">Lv6</span>
                            
                        </div>
                        <div class="meta-info border-box">
                            

<div class="article-meta-info-container border-box post">
    <div class="article-meta-info border-box">
        


        
            <span class="meta-info-item article-create-date">
                <i class="icon fa-solid fa-calendar-check"></i>&nbsp;
                <span class="pc">2022-03-17 13:13:51</span>
                <span class="mobile">2022-03-17 13:13</span>
            </span>

            <span class="meta-info-item article-update-date">
                <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                <span class="pc">2023-03-29 22:05:05</span>
            </span>
        

        
            <span class="meta-info-item article-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul>
                    
                            <li class="category-item">
                                
                                <a href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a>
                            </li>
                        
                    
                </ul>
            </span>
        

        
            <span class="article-tag meta-info-item border-box">
                <i class="icon fas fa-tags"></i>&nbsp;
                <ul>
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a></li>
                        
                    
                </ul>
            </span>
        

        
        
            <span class="meta-info-item article-wordcount">
                <i class="icon fas fa-file-word"></i>&nbsp;<span>5.6k 字</span>
            </span>
        
        
            <span class="meta-info-item article-min2read">
                <i class="icon fas fa-clock"></i>&nbsp;<span>22 分钟</span>
            </span>
        
        
            <span class="meta-info-item article-pv">
                <i class="icon fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
            </span>
        
    </div>

    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content keep-markdown-body">
                

                <p>WebGoat代码审计-02-SQL注入</p>
<span id="more"></span>
<h1 id="WebGoat-代码审计-02-SQL-注入"><a href="#WebGoat-代码审计-02-SQL-注入" class="headerlink" title="WebGoat 代码审计-02-SQL 注入"></a>WebGoat 代码审计-02-SQL 注入</h1><ul>
<li>要学 SQL 注入，必须要知道 SQL 注入的根本：使得浏览器中的 SQL 语句闭合。</li>
<li>其余废话就不多说了，主要是针对于代码审计方面的 SQL 注入，从根本上理解 SQL 注入。</li>
</ul>
<h2 id="0x01-SQL-Injection-intro"><a href="#0x01-SQL-Injection-intro" class="headerlink" title="0x01 SQL Injection (intro)"></a>0x01 SQL Injection (intro)</h2><h3 id="1-SQL-Injection-intro-PageLesson2-select"><a href="#1-SQL-Injection-intro-PageLesson2-select" class="headerlink" title="1. SQL Injection (intro) PageLesson2 select"></a>1. SQL Injection (intro) PageLesson2 select</h3><blockquote>
<p>Select 语句的使用</p>
</blockquote>
<p>靶场界面如图所示</p>


<p>其中有一段：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">There are three main categories of SQL commands:</span><br><span class="line"></span><br><span class="line">-   Data Manipulation Language (DML)</span><br><span class="line">    </span><br><span class="line">-   Data Definition Language (DDL)</span><br><span class="line">    </span><br><span class="line">-   Data Control Language (DCL)</span><br></pre></td></tr></table></figure>
<p>这里意思是让我们掌握一些基本的 SQL 语言，包括：</p>
<p>DML(data manipulation language)：数据操作语言，用于执行查询的语法。例如增删改查</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">UPDATE</span> <span class="keyword">DELETE</span> </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span></span><br></pre></td></tr></table></figure>

<p>DDL(data definition language)：数据定义语言，创建或删除表格，定义索引等。例如</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE <span class="operator">-</span> 创建新数据库</span><br><span class="line"><span class="keyword">ALTER</span> DATABASE <span class="operator">-</span> 修改数据库</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="operator">-</span> 创建新表</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="operator">-</span> 变更（改变）数据库表</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="operator">-</span> 删除表</span><br><span class="line"><span class="keyword">CREATE</span> INDEX <span class="operator">-</span> 创建索引（搜索键）</span><br><span class="line"><span class="keyword">DROP</span> INDEX <span class="operator">-</span> 删除索引</span><br></pre></td></tr></table></figure>

<p>DCL(Data Control Language)：数据库控制语言，授权，角色控制等。例如</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> 授权  </span><br><span class="line"><span class="keyword">REVOKE</span> 取消授权</span><br></pre></td></tr></table></figure>

<p>TCL(Transaction Control Language)：事务控制语言，例如</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SAVEPOINT</span> 设置保存点  </span><br><span class="line"><span class="keyword">ROLLBACK</span>  回滚  </span><br><span class="line"><span class="keyword">SET</span> TRANSACTION</span><br></pre></td></tr></table></figure>

<ul>
<li>靶场要求: Try to retrieve the department of the employee Bob Franco。也就是查询 Bob Franco是哪个部门的。</li>
<li>注意，此时的我们是有 admin 权限的，所以直接写查询语句即可。</li>
<li>语法：”select something from table where colunm &#x3D; *”</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> department <span class="keyword">from</span> employees <span class="keyword">where</span> first_name<span class="operator">=</span><span class="string">&#x27;Bob&#x27;</span> <span class="keyword">and</span> last_name<span class="operator">=</span><span class="string">&#x27;Franco&#x27;</span>;</span><br></pre></td></tr></table></figure>



<p>如此，我们的查询就成功了~ 老规矩，代码审计</p>


<p>这里设置了简单的 SQL 查询语句，并设置了 <code>TYPE_SCROLL_INSENSITIVE</code>: 也就是对底层数据变换不敏感； 还设置了 <code>CONCUR_READ_ONLY</code>————只读。<br>后面语句的意思：判断 SQL 语句查询出的 department 是否等于 Marketing。<br>所以这里，我们输入如下语句也可以实现：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;Marketing&#x27;</span> <span class="keyword">as</span> department <span class="keyword">from</span> employees;</span><br></pre></td></tr></table></figure>


<h3 id="2-SQL-Injection-intro-PageLesson3-update"><a href="#2-SQL-Injection-intro-PageLesson3-update" class="headerlink" title="2. SQL Injection (intro) PageLesson3 update"></a>2. SQL Injection (intro) PageLesson3 update</h3><blockquote>
<p>update 语句的使用</p>
</blockquote>
<p>靶场界面如图所示</p>


<ul>
<li>直接做题，将 Tobi Barnett 的部门修改为 Sales。</li>
<li>语法: “update tablename set colunm&#x3D;’’ where colunm &#x3D; * “”</li>
</ul>
<p>payload:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> employees <span class="keyword">SET</span> department <span class="operator">=</span> <span class="string">&#x27;Sales&#x27;</span> <span class="keyword">where</span> first_name<span class="operator">=</span><span class="string">&#x27;Tobi&#x27;</span> <span class="keyword">and</span> last_name<span class="operator">=</span><span class="string">&#x27;Barnett&#x27;</span>;</span><br></pre></td></tr></table></figure>


<p>如此，我们的查询就成功了~ 老规矩，代码审计</p>


<p>代码判断 department 是否等于 Sales。<br>和上题类似，可以通过这种方法绕过</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> employees <span class="keyword">set</span> department<span class="operator">=</span><span class="string">&#x27;Sales&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-SQL-Injection-intro-PageLesson4-alter"><a href="#3-SQL-Injection-intro-PageLesson4-alter" class="headerlink" title="3. SQL Injection (intro) PageLesson4 alter"></a>3. SQL Injection (intro) PageLesson4 alter</h3><blockquote>
<p>Alter 语句的使用</p>
</blockquote>
<p>靶场界面如图所示</p>


<ul>
<li>直接做题，要求将列 “phone”（varchar（20））添加到表 “employees”。</li>
<li>语法: “alter table tablename add colunmname colunm type”</li>
</ul>
<p>payload：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> employees <span class="keyword">add</span> phone <span class="type">varchar</span>(<span class="number">20</span>);</span><br></pre></td></tr></table></figure>



<p>老样子，源码</p>


<p>我们看到这里的语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ResultSet results <span class="operator">=</span> statement.executeQuery(&quot;SELECT phone from employees;&quot;);</span><br></pre></td></tr></table></figure>

<p>在我们执行完 SQL 语句之后，phone 列表已经被插入到了 employees 表里，此时的变量 results 被赋值，才有了后面的以切判断。</p>
<h3 id="4-SQL-Injection-intro-PageLesson5-grant"><a href="#4-SQL-Injection-intro-PageLesson5-grant" class="headerlink" title="4. SQL Injection (intro) PageLesson5 grant"></a>4. SQL Injection (intro) PageLesson5 grant</h3><blockquote>
<p>Grant 命令的使用，事关权限问题</p>
</blockquote>
<p>靶场界面如图所示</p>


<ul>
<li>直接做题，要求将表 “grant_rights” 的权限开通给用户 “unauthorized_users”。</li>
<li>语法: “grant all on table to user;”</li>
</ul>
<p>这里的 <strong>all</strong> 可以替换为其他的权限，例如增删改查。</p>
<p>老样子，源码</p>


<p>我们看到这里的 SQL 语句:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> INFORMATION_SCHEMA.TABLE_PRIVILEGES <span class="keyword">WHERE</span> TABLE_NAME <span class="operator">=</span> ? <span class="keyword">AND</span> GRANTEE <span class="operator">=</span> ?</span><br></pre></td></tr></table></figure>

<p>TABLE_NAME &#x3D; GRANT_RIGHTS<br>GRANTEE &#x3D; UNAUTHORIZED_USER<br>也就是检查是否存在，ok<del>pass</del></p>
<hr>
<p><strong>SQL 注入一般存在于这种语句中 <code>&quot; SELECT * FROM users WHERE name = &#39;&#39; &quot;;</code></strong></p>
<ul>
<li>原理：闭合 SQL 语句</li>
</ul>
<hr>
<h3 id="5-SQL-Injection-intro-PageLesson9-万能密码"><a href="#5-SQL-Injection-intro-PageLesson9-万能密码" class="headerlink" title="5. SQL Injection (intro) PageLesson9 万能密码"></a>5. SQL Injection (intro) PageLesson9 万能密码</h3><p>靶场界面如图所示</p>


<ul>
<li>直接做题，看着就像是万能密码</li>
<li>题目里面告诉了我们 SQL 查询语句</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;SELECT * FROM user_data WHERE first_name = &#x27;John&#x27; AND last_name = &#x27;&quot; <span class="operator">+</span> lastName <span class="operator">+</span> &quot;&#x27;&quot;;</span><br></pre></td></tr></table></figure>
<p>这里我们选择 Smith’ or ‘1’&#x3D;’1,成功~</p>


<p>得到的 SQL 语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> user_data <span class="keyword">WHERE</span> first_name <span class="operator">=</span> <span class="string">&#x27;John&#x27;</span> <span class="keyword">and</span> last_name <span class="operator">=</span> <span class="string">&#x27;Smith&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;1&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span></span><br></pre></td></tr></table></figure>
<p>因为 last_name 这里等于 **’Smith’ or ‘1’&#x3D;’1’**永远为真，</p>
<p>SQL 语句也就因此变换为</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> user_data <span class="keyword">WHERE</span> first_name <span class="operator">=</span> <span class="string">&#x27;John&#x27;</span> <span class="keyword">and</span> last_name <span class="operator">=</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">or</span> <span class="literal">TRUE</span></span><br></pre></td></tr></table></figure>
<p>而所有的数据对于 **last_name&#x3D;TRUE **都成立，故可以查询出所有的数据。</p>
<p>老样子，源码</p>


<p>这一行的代码：</p>
<blockquote>
<p>accout: Smith’<br>operator: or<br>injection: ‘1’&#x3D;’1</p>
</blockquote>


<p>而传进去的参数 <code>accoutName</code> &#x3D; <code>Smith&#39; or &#39;1&#39;=&#39;1</code><br>也就有了我们看到的 SQL 语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> user_data <span class="keyword">WHERE</span> first_name <span class="operator">=</span> <span class="string">&#x27;John&#x27;</span> <span class="keyword">and</span> last_name <span class="operator">=</span> <span class="string">&#x27;Smith&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;1&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-SQL-Injection-intro-PageLesson10-数字型注入"><a href="#6-SQL-Injection-intro-PageLesson10-数字型注入" class="headerlink" title="6. SQL Injection (intro) PageLesson10 数字型注入"></a>6. SQL Injection (intro) PageLesson10 数字型注入</h3><p>所谓数字型注入即参数为数字，不需要添加其他符号来做闭合，如 <code>id=1 or 1=1</code> 的形式</p>
<h4 id="测试数字型注入的步骤："><a href="#测试数字型注入的步骤：" class="headerlink" title="测试数字型注入的步骤："></a>测试数字型注入的步骤：</h4><h5 id="1-加单引号，id-x3D-3’"><a href="#1-加单引号，id-x3D-3’" class="headerlink" title="(1) 加单引号，id&#x3D;3’"></a>(1) 加单引号，id&#x3D;3’</h5><p>对应的sql：select * from table where id&#x3D;3’ 这时sql语句出错，程序无法正常从数据库中查询出数据，就会抛出异常；</p>
<h5 id="2-加-and-1-x3D-1，id-x3D-3-and-1-x3D-1"><a href="#2-加-and-1-x3D-1，id-x3D-3-and-1-x3D-1" class="headerlink" title="(2) 加 and 1&#x3D;1，id&#x3D;3 and 1&#x3D;1"></a>(2) 加 and 1&#x3D;1，id&#x3D;3 and 1&#x3D;1</h5><p>对应的sql：select * from table where id&#x3D;3’ and 1&#x3D;1 语句执行正常，与原始页面如任何差异；</p>
<h5 id="3-加and-1-x3D-2，id-x3D-3-and-1-x3D-2"><a href="#3-加and-1-x3D-2，id-x3D-3-and-1-x3D-2" class="headerlink" title="(3) 加and 1&#x3D;2，id&#x3D;3 and 1&#x3D;2"></a>(3) 加and 1&#x3D;2，id&#x3D;3 and 1&#x3D;2</h5><p>对应的sql：select * from table where id&#x3D;3 and 1&#x3D;2 语句可以正常执行，但是无法查询出结果，所以返回数据与原始网页存在差异</p>
<p>如果满足以上三点，则可以判断该URL存在数字型注入。</p>
<hr>
<p>靶场界面如图所示</p>


<ul>
<li>题目已经给了 SQL 查询语句</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;SELECT * FROM user_data WHERE login_count = &quot; <span class="operator">+</span> Login_Count <span class="operator">+</span> &quot; AND userid = &quot;  <span class="operator">+</span> User_ID;</span><br></pre></td></tr></table></figure>

<p>再结合题目提示 “数字型注入”，直接在 Login_Count 中输入 <code>1 or 1=1</code> —————进行最基本的数字型注入，查看回显。</p>


<p>呃，居然没有任何回显，意料之外……<br>又在 User_Id 框中输入 1 or 1&#x3D;1，还是不对。</p>


<p>前两种情况都错了，尝试第三种情况，Login_Count 的值随意输入，将 User_Id 的值输入为 1 or 1&#x3D;1</p>


<p>终于成功了，可是为什么 Login_Count 的值是 1 or 1&#x3D;1 时总是得不到理想的回显呢？</p>
<p>老样子，源码</p>

<blockquote>
<p>变量：<br>login_count: 1<br>userid: 1 or 1&#x3D;1</p>
</blockquote>
<p>这里突然发现，SQL 语句同之前的不一样了，出现了一个新朋友————“?”</p>
<ul>
<li>对应的 SQL 语句，我们把它单独拉出来</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;SELECT * From user_data WHERE Login_Count = ? and userid= &quot; <span class="operator">+</span> accountName;</span><br></pre></td></tr></table></figure>

<p>“?” 在 SQL 语句中起到了预编译的作用，当用户数据来的时候,就会直接替换掉? 这里不存在再次编译, 所以也就不会解析用户数据了，能够很好的预防 SQL 注入。后面的代码会将 Login_Count 转换成数字类型，如果没有出错才会进行后续的操作。</p>
<p>简而言之，预编译读入了输入的字面意思，从而不将其与 SQL 语句混淆。<br>由此可见，预编译对于 SQL 注入的预防功能还是卓有成效的 ~</p>
<h3 id="7-SQL-Injection-intro-PageLesson11-字符型注入"><a href="#7-SQL-Injection-intro-PageLesson11-字符型注入" class="headerlink" title="7. SQL Injection (intro) PageLesson11 字符型注入"></a>7. SQL Injection (intro) PageLesson11 字符型注入</h3><ul>
<li>字符串注入一般需要通过单引号来闭合的。同数字型注入类似，但数字型注入不需要单引号来闭合。</li>
<li>字符型注入有一个更出名的名字 ———— 万能密码</li>
</ul>
<h4 id="测试字符型注入的步骤："><a href="#测试字符型注入的步骤：" class="headerlink" title="测试字符型注入的步骤："></a>测试字符型注入的步骤：</h4><h5 id="1-加单引号，id-x3D-3’-and-password-x3D-123"><a href="#1-加单引号，id-x3D-3’-and-password-x3D-123" class="headerlink" title="(1) 加单引号，id&#x3D;3’ and password&#x3D;123"></a>(1) 加单引号，id&#x3D;3’ and password&#x3D;123</h5><p>由于加单引号后变成三个单引号，则无法执行，程序会报错；一般的报错都是像这样。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &#x27;123&#x27;&#x27; at line 1</span><br></pre></td></tr></table></figure>


<h5 id="2-尝试绕过，通过-1’-or-‘1’-x3D-’1"><a href="#2-尝试绕过，通过-1’-or-‘1’-x3D-’1" class="headerlink" title="(2) 尝试绕过，通过 1’ or ‘1’&#x3D;’1"></a>(2) 尝试绕过，通过 1’ or ‘1’&#x3D;’1</h5><p>此时的 SQL 语句会变成这样：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> first_name <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> last_name <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;1&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span></span><br></pre></td></tr></table></figure>

<p>靶场界面如图所示</p>


<ul>
<li>用万能密码进行绕过，题意，服务器通过 “auth_tan” 来判断是否为员工本人。那么这里万能密码的应用点就应该在 “auth_tan”</li>
</ul>


<p>老样子，源码</p>


<p>很明显，我们通过万能密码的方式拼接了 SQL 查询语句。</p>
<h3 id="8-SQL-Injection-intro-PageLesson12-堆叠注入"><a href="#8-SQL-Injection-intro-PageLesson12-堆叠注入" class="headerlink" title="8. SQL Injection (intro) PageLesson12 堆叠注入"></a>8. SQL Injection (intro) PageLesson12 堆叠注入</h3><p>靶场界面如图所示</p>


<p>Lesson12 与 Lesson11 的 SQL 查询语句并没有改动，需要我们将 John Smith 的工资拉高，拉的比任何人都要高。</p>
<ul>
<li>要完成上述所说的操作，唯一想到的只有堆叠注入了。</li>
<li>堆叠注入：同时执行两句 SQL 语句。最简单的堆叠注入语句</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users;<span class="keyword">DELETE</span> <span class="keyword">FROM</span> test</span><br></pre></td></tr></table></figure>

<p>先查询 user 表，然后再从 test 数据库里删除 user 表。<br>在本题中，要将 John Smith 的工资修改地比另外两人高，直接构造 payload :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;; update employees set salary=9999999 where last_name=&#x27;</span>Smith<span class="string">&#x27;;-- -</span></span><br></pre></td></tr></table></figure>

<p>最后的 <code>-- -</code> 是将 SQL 语句后面的部分注释掉，从而实现修改数据。</p>


<p>关键拼接部分的源码与上题完全相同，不再加以分析。</p>
<h3 id="9-SQL-Injection-intro-PageLesson13-干完坏事记得删历史记录！"><a href="#9-SQL-Injection-intro-PageLesson13-干完坏事记得删历史记录！" class="headerlink" title="9. SQL Injection (intro) PageLesson13 干完坏事记得删历史记录！"></a>9. SQL Injection (intro) PageLesson13 干完坏事记得删历史记录！</h3><blockquote>
<p>之前看某些入门级的黑客书籍时，总会说到删除历史记录什么的，直到现在才对删除历史记录有一定的感受。</p>
<p>SQL 的操作都保存在一个名为 “access_log” 的表格中。所以我们要删除历史记录的话，必然是执行 drop access_log 的命令</p>
</blockquote>
<p>靶场界面如图所示</p>


<p>点击 Search logs，可以发现我们对数据库的所有操作，包括之前违规 “涨工资” 的操作。</p>


<p>想到是对数据库的操作，立马想到堆叠注入。构造 payload</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;;drop table access_log; -- -</span></span><br></pre></td></tr></table></figure>

<p>至此，intro 部分全部通关。</p>
<hr>
<hr>
<hr>
<h2 id="0x02-SQL-Injection-advanced"><a href="#0x02-SQL-Injection-advanced" class="headerlink" title="0x02 SQL Injection (advanced)"></a>0x02 SQL Injection (advanced)</h2><p>前文 intro 模块介绍了一些基本的 SQL 语句，Advanced 部分将介绍多重 SELECT，也就是我们常说的联合注入 ———— UNION SELECT</p>
<ul>
<li>在介绍 UNION SELECT 之前，先来熟悉以下 SQL 语句当中的一些特殊符号，这在后续的渗透中经常会用到。</li>
</ul>
<h3 id="1-联合注入前的-Preparation"><a href="#1-联合注入前的-Preparation" class="headerlink" title="1. 联合注入前的 Preparation"></a>1. 联合注入前的 Preparation</h3><h4 id="Prepare①-SQL-语句当中的特殊符号"><a href="#Prepare①-SQL-语句当中的特殊符号" class="headerlink" title="Prepare① : SQL 语句当中的特殊符号"></a>Prepare① : SQL 语句当中的特殊符号</h4><h5 id="1-常见注释符："><a href="#1-常见注释符：" class="headerlink" title="(1) 常见注释符："></a>(1) 常见注释符：</h5><blockquote>
<p>行内注释符号<code>/**/</code>； 应用 —— <code>/* 123 */</code>，能够将123注释。</p>
<p>行外注释符号 <code>--</code> ；<code>#</code>; 应用 —— <code>SELECT * FROM users WHERE name = &#39;admin&#39; -- AND pass = &#39;pass&#39;</code>可以将 “–” 后的所有内容都注释掉。</p>
</blockquote>
<h5 id="2-常见查询符："><a href="#2-常见查询符：" class="headerlink" title="(2) 常见查询符："></a>(2) 常见查询符：</h5><blockquote>
<p>提供多组查询，也就是堆叠注入，符号为 <code>;</code> 应用 —— <code>SELECT * FROM users; DROP TABLE users;</code></p>
</blockquote>
<h5 id="3-常见连接符："><a href="#3-常见连接符：" class="headerlink" title="(3) 常见连接符："></a>(3) 常见连接符：</h5><blockquote>
<p>用于字符串的连接，单引号<code>&#39;</code>，加号<code>+</code>，管道符<code>||</code>， 应用 —— <code>SELECT * FROM users WHERE name = &#39;+char(27) OR 1=1</code></p>
</blockquote>
<h4 id="Prepare②-SQL-UNION-SELECT-联合查询"><a href="#Prepare②-SQL-UNION-SELECT-联合查询" class="headerlink" title="Prepare②: SQL UNION SELECT 联合查询"></a>Prepare②: SQL UNION SELECT 联合查询</h4><ul>
<li>联合查询的用法：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> first_name <span class="keyword">FROM</span> user_system_data <span class="keyword">UNION</span> <span class="keyword">SELECT</span> login_count <span class="keyword">FROM</span> user_data;</span><br></pre></td></tr></table></figure>
<p>这时候肯定有好多小伙伴要好奇问了，你说了这个联合查询，那联合查询没有任何限制吗？———————— 答案当然是有限制！</p>
<p>在使用 UNION SELECT 联合查询之前，必须要先判断数据表有多少列，试想一下，如果数据表有三列，而 UNION SELECT 了四列，必然会导致报错。</p>
<h4 id="Prepare③-SQL-UNION-SELECT-的两个前提条件"><a href="#Prepare③-SQL-UNION-SELECT-的两个前提条件" class="headerlink" title="Prepare③: SQL UNION SELECT 的两个前提条件"></a>Prepare③: SQL UNION SELECT 的两个前提条件</h4><h5 id="条件一、-SELECT-的列数与数据库的列数相等："><a href="#条件一、-SELECT-的列数与数据库的列数相等：" class="headerlink" title="条件一、 SELECT 的列数与数据库的列数相等："></a>条件一、 SELECT 的列数与数据库的列数相等：</h5><p>举个栗子: 数据库有 3 列，那么 union 查询时的语句应该符合如下基本构造</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; union select 1,2,3 #</span></span><br></pre></td></tr></table></figure>
<p>如果数据库有 4 列，构造如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; union select 1,2,3,4 #</span></span><br></pre></td></tr></table></figure>

<h5 id="条件二、-查询的数据要与原数据库列的数据类型匹配"><a href="#条件二、-查询的数据要与原数据库列的数据类型匹配" class="headerlink" title="条件二、 查询的数据要与原数据库列的数据类型匹配"></a>条件二、 查询的数据要与原数据库列的数据类型匹配</h5><p>乍一眼看这段话是比较抽象的，我们还是简单举个例子。</p>
<p>大家都知道，在新建数据库时，我们必须命名 table_name, column_name 以及 column_type ————这个东西就是数据库列的数据类型。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons  </span><br><span class="line">(  </span><br><span class="line">PersonID <span class="type">int</span>,  </span><br><span class="line">LastName <span class="type">varchar</span>(<span class="number">255</span>),  </span><br><span class="line">FirstName <span class="type">varchar</span>(<span class="number">255</span>),  </span><br><span class="line">Address <span class="type">varchar</span>(<span class="number">255</span>),  </span><br><span class="line">City <span class="type">varchar</span>(<span class="number">255</span>)  </span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>对应这一个新的数据表 Persons，我们的联合查询应该如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; union select 1,&quot;张三&quot;,&quot;李四&quot;,&quot;322111&quot;,&quot;杭州&quot; #</span></span><br></pre></td></tr></table></figure>
<p>如果第一个数据输入的并不是 int 类型的数据的话，一定会遇到报错，我们这里用’1’作为例子。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Conversion failed <span class="keyword">when</span> converting the <span class="type">varchar</span> <span class="keyword">value</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">to</span> data type int.</span><br></pre></td></tr></table></figure>

<hr>
<ul>
<li>那么问题又来了，当我们实战渗透，进行攻击的时候，肯定不知道对方的数据表有几列啊，这时应该怎么办呢？</li>
</ul>
<h5 id="Solution1-通过-ORDER-BY-命令"><a href="#Solution1-通过-ORDER-BY-命令" class="headerlink" title="Solution1 通过 ORDER BY 命令"></a>Solution1 通过 ORDER BY 命令</h5><p>假设是字符型注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; ORDER BY 1 --</span></span><br><span class="line"><span class="string">&#x27;</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">2</span> <span class="comment">--</span></span><br><span class="line"><span class="string">&#x27; ORDER BY 3 --</span></span><br><span class="line"><span class="string">etc.</span></span><br></pre></td></tr></table></figure>


<h5 id="Solution2-通过-UNION-SELECT-NULL-来判断列数"><a href="#Solution2-通过-UNION-SELECT-NULL-来判断列数" class="headerlink" title="Solution2 通过 UNION SELECT NULL 来判断列数"></a>Solution2 通过 UNION SELECT NULL 来判断列数</h5><p>有多少个列，就写多少个 NULL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; UNION SELECT NULL --</span></span><br><span class="line"><span class="string">&#x27;</span> <span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="keyword">NULL</span>,<span class="keyword">NULL</span> <span class="comment">--</span></span><br><span class="line"><span class="string">&#x27; UNION SELECT NULL,NULL,NULL --</span></span><br><span class="line"><span class="string">etc.</span></span><br></pre></td></tr></table></figure>
<ul>
<li>特别需要注意的：在 Oracle 数据库中，需要改为</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="keyword">NULL</span> <span class="keyword">FROM</span> DUAL <span class="comment">--</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p>好啦，该讲的知识点也都讲完了，是时候打靶场了~</p>
</blockquote>
<h3 id="2-SQL-Injection-advanced-PageLesson3"><a href="#2-SQL-Injection-advanced-PageLesson3" class="headerlink" title="2. SQL Injection (advanced) PageLesson3"></a>2. SQL Injection (advanced) PageLesson3</h3><p>靶场界面如图所示</p>


<ul>
<li>题目告诉我们已经存在的两个数据表 user_data 和 user_system_data</li>
<li>两个任务：1. 从表中获取到所有的数据；2. 搞到 Dave 的密码。</li>
</ul>
<p>看到这个 Get Accout Info 的按钮，这和 Check Password的一定是分开的，那么我们先尝试闭合 SQL 语句，在第一个查询框内输入 <code>1&#39; or &#39;1&#39;=&#39;1</code></p>



<h4 id="解法一、使用堆叠注入"><a href="#解法一、使用堆叠注入" class="headerlink" title="解法一、使用堆叠注入"></a>解法一、使用堆叠注入</h4><p>根据我们前文提到的<strong>堆叠注入</strong>，通过分号隔开两条 SQL 语句，payload：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;; select * from user_system_data -- </span></span><br></pre></td></tr></table></figure>



<p>由此，我们爆出了 user_system_data 表的数据，也得到了 Dave 的 password。但是 WebGoat 此时让我们再使用 UNION 查询来完成 SQL 注入。</p>
<h4 id="解法二、使用联合注入"><a href="#解法二、使用联合注入" class="headerlink" title="解法二、使用联合注入"></a>解法二、使用联合注入</h4><ul>
<li>从之前的尝试中，我们发现使用万能密码注入时，返回的数据有七列。而 user_system_data 表只有4列，所以需要将从 user_system_data 表中查到的数据补齐到7列。</li>
<li>7列数据： USERID, FIRST_NAME, LAST_NAME, CC_NUMBER, CC_TYPE, COOKIE, LOGIN_COUNT</li>
<li>目前 user_system_data 有4列：userid， user_name, password, cookie，将其补齐到7列。<br>由此思考出 UNION SELECT 的数据：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userid, user_name, password, <span class="keyword">null</span>, <span class="keyword">null</span>, cookie, <span class="keyword">null</span></span><br></pre></td></tr></table></figure>

<p>进一步构造 payload：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; or 1=1 union select userid,user_name,password,null,null,cookie,null from user_system_data --</span></span><br></pre></td></tr></table></figure>
<p>这样子我们可以爆出所有的数据</p>


<p>还有一种只爆出 Dave password 的 payload，在这一种 payload 中，可以很明显地看出来 Union 联合查询要满足的第二个条件———————— 查询的数据要与原数据库列的数据类型匹配。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;or 1=1 union select 1,&#x27;</span><span class="number">2</span><span class="string">&#x27;,&#x27;</span><span class="number">3</span><span class="string">&#x27;,&#x27;</span><span class="number">4</span><span class="string">&#x27;,&#x27;</span><span class="number">5</span><span class="string">&#x27;,password, 7 from user_system_data where user_name=&#x27;</span>dave<span class="string">&#x27;--</span></span><br></pre></td></tr></table></figure>


<hr>
<p>老样子，源码</p>


<p>源码中还是对 SQL 语句不加任何的过滤，不同的是这里出现了正则表达式，判断我们是否在查询语句中使用了 UNION 联合查询。</p>
<h3 id="3-SQL-盲注"><a href="#3-SQL-盲注" class="headerlink" title="3. SQL 盲注"></a>3. SQL 盲注</h3><p>在 WebGoat 网站上对盲注的英文描述机翻过来之后，比较不准确，这里分享一下自己的理解。</p>
<h4 id="1-什么是-SQL-盲注"><a href="#1-什么是-SQL-盲注" class="headerlink" title="(1) 什么是 SQL 盲注"></a>(1) 什么是 SQL 盲注</h4><ul>
<li>首先 SQL 盲注很重要的一点是无回显</li>
<li>其次 SQL 盲注存在非显性回显，也就是说从侧面可以看出回显</li>
</ul>
<blockquote>
<p>展开来给大家讲一讲</p>
</blockquote>
<p>SQL 盲注的意思是，注入数据到 SQL 语句中，服务器不会返回数据库里的详细信息 ———————— 无回显的表现。</p>
<p>只会给出 true 或 false 的信息，或者给出延时的信息，或者一些其他的信息(比如报错) ———————— 这里就是我所说的侧面回显。</p>
<p>所以，我们只能根据有限的信息去获取数据库中更多地信息，这种方式像盲人摸象一样，只能一点一点的去收集数据库的信息（每一次的true表示获取一个有效信息），来慢慢形成对整个数据库信息的理解（表名是什么，列名是什么），最终达到获取数据库中数据的目的（获取某个表的某个值）。</p>
<h4 id="2-判断-SQL-盲注的方法"><a href="#2-判断-SQL-盲注的方法" class="headerlink" title="(2) 判断 SQL 盲注的方法"></a>(2) 判断 SQL 盲注的方法</h4><ul>
<li>最重要的一定是先找注入点，判断是否存在注入点，多试试各种地方，比如 Login 的登录界面，Register 注册界面等</li>
</ul>
<h5 id="1-针对布尔盲注，也就是-True-与-False-的回显"><a href="#1-针对布尔盲注，也就是-True-与-False-的回显" class="headerlink" title="1. 针对布尔盲注，也就是 True 与 False 的回显"></a>1. 针对布尔盲注，也就是 True 与 False 的回显</h5><ul>
<li>布尔盲注，只会根据你的注入信息返回 True 或 False，也就没有了之前的报错信息：<code>You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &#39;123&#39;&#39; at line 1</code></li>
</ul>
<h6 id="布尔盲注判断方法："><a href="#布尔盲注判断方法：" class="headerlink" title="布尔盲注判断方法："></a>布尔盲注判断方法：</h6><blockquote>
<ol>
<li>判断注入点<br>1’ and 1&#x3D;1   &#x2F;&#x2F; 页面返回有数据<br>1’ and 1&#x3D;2   &#x2F;&#x2F; 页面返回无数据<br>此种情况可以推出存在 SQL 注入</li>
<li>判断当前页面字段数<br>1’ and 1&#x3D;1 order by 2 –   &#x2F;&#x2F; 页面返回有数据<br>1’ and 1&#x3D;2 order by 3 –   &#x2F;&#x2F; 页面返回无数据<br>判断出当前页面字段数为 2</li>
</ol>
</blockquote>
<h6 id="时间盲注判断方法"><a href="#时间盲注判断方法" class="headerlink" title="时间盲注判断方法"></a>时间盲注判断方法</h6><blockquote>
<ol>
<li>判断注入点的 SQL 语句<br>1’ and 1&#x3D;1–  &#x2F;&#x2F; 页面返回有数据<br>1’ and 1&#x3D;2– &#x2F;&#x2F;  页面返回有数据<br><strong>页面的返回没有变化，可能是盲注</strong>；</li>
<li>判断是何种盲注<br>Select name from table where id &#x3D; 1 and if（布尔表达式，sleep(5),(1))； &#x2F;&#x2F; 条件为真时延时 5s<br>可以通过简单的id &#x3D; 1’ and sleep(2)判断是否存在时间盲注</li>
</ol>
</blockquote>
<p>还有一些深度用法，我们以 WebGoat 靶场下的题目为例说明</p>
<h3 id="4-SQL-Injection-advanced-PageLesson5-布尔盲注"><a href="#4-SQL-Injection-advanced-PageLesson5-布尔盲注" class="headerlink" title="4. SQL Injection (advanced) PageLesson5 布尔盲注"></a>4. SQL Injection (advanced) PageLesson5 布尔盲注</h3><p>靶场界面如图所示</p>


<h4 id="1-探测注入点"><a href="#1-探测注入点" class="headerlink" title="(1) 探测注入点"></a>(1) 探测注入点</h4><ul>
<li>界面中有 Login 与 Register 两个界面，我们依次寻找注入点。注入点无非四处，Login 界面下的用户名密码，Register 下的用户名密码。</li>
</ul>
<p>Login 界面下对 username 进行注入点探测，输入<code>1&#39; or &#39;1&#39;=&#39;1</code></p>


<p>得到回显：”No results matched, try again.”<br>这里得到的回显代表了不存在 SQL 注入，如果存在 SQL 注入的话必然是会报错的。</p>
<p>在密码处尝试探测注入点，得到的结果同上。</p>
<ul>
<li>尝试后发现，Login 界面下的 Username 与 Password 都不存在 SQL 注入</li>
</ul>
<p>转战 Register 界面，我们先注册一个名为 hello 密码为 123 的账号。</p>


<p>注册完之后，在 Register 界面再进行 SQL 注入点的探测</p>
<blockquote>
<p>hello’ or 1&#x3D;1 –<br>hello’ or 1&#x3D;2 –<br>hello’ and 1&#x3D;1 –<br>hello and 1&#x3D;3 –</p>
</blockquote>
<p>先贴四张图，给大家看一看回显</p>





<p>更直观一些，我们列一张表格总结一下</p>
<table>
<thead>
<tr>
<th>username</th>
<th>回显</th>
</tr>
</thead>
<tbody><tr>
<td>hello’ or 1&#x3D;1 –</td>
<td>already exists please try to register with a different username.这说明存在SQL注入，因为如果不存在SQL注入，用户名**”hello’ or 1&#x3D;1 –”<strong>是不存在的，不应该提示『已存在』。说明</strong>“hello’ or 1&#x3D;1 –”**SQL语句被解析了</td>
</tr>
<tr>
<td>hello’ or 1&#x3D;2 –</td>
<td>already exists please try to register with a different username.  说明存在SQL注入，否则用户名为**”hello’ or 1&#x3D;2 –”**的用户是不存在的。</td>
</tr>
<tr>
<td>hello’ and 1&#x3D;1 –</td>
<td>already exists please try to register with a different username.  说明存在SQL注入，否则用户名为**””hello’ and 1&#x3D;1 –””**的用户是不存在的。</td>
</tr>
<tr>
<td>hello’ and 1&#x3D;2 –</td>
<td>User hello’ and 1&#x3D;2 – created, please proceed to the login page.如果单从这一条来说，是不能确定是否存在SQL注入的，因为有两种可能性。可能1： 用户名为hello’ and 1&#x3D;2 – 的用户确实不存在，所以可以注册。可能2：and 1&#x3D;2 起作用了，它的结果是 false，对于 select * from xxx_table where false 来说，是始终不会查询到数据的。所以可以注册</td>
</tr>
</tbody></table>
<p>由上述分析，我们可以确定 Register 处存在 SQL 盲注。</p>
<h4 id="2-进阶使用-x2F-理解布尔盲注"><a href="#2-进阶使用-x2F-理解布尔盲注" class="headerlink" title="(2) 进阶使用&#x2F;理解布尔盲注"></a>(2) 进阶使用&#x2F;理解布尔盲注</h4><ul>
<li>题目目的：让我们以 Tom 的身份登录</li>
</ul>
<p>tom的组合有好多中写法。<br>简单测试，发现在数据库中已经存在的用户名是 tom ~</p>


<h5 id="如果想要以-tom-的身份登录无非是两种方式"><a href="#如果想要以-tom-的身份登录无非是两种方式" class="headerlink" title="如果想要以 tom 的身份登录无非是两种方式"></a>如果想要以 tom 的身份登录无非是两种方式</h5><h6 id="一、通过联合注入爆出-tom-的数据-————-使用到布尔盲注"><a href="#一、通过联合注入爆出-tom-的数据-————-使用到布尔盲注" class="headerlink" title="一、通过联合注入爆出 tom 的数据 ———— 使用到布尔盲注"></a>一、通过联合注入爆出 tom 的数据 ———— 使用到布尔盲注</h6><h6 id="二、篡改-tom-的密码-———-运用我们之前所讲的堆叠注入"><a href="#二、篡改-tom-的密码-———-运用我们之前所讲的堆叠注入" class="headerlink" title="二、篡改 tom 的密码 ——— 运用我们之前所讲的堆叠注入"></a>二、篡改 tom 的密码 ——— 运用我们之前所讲的堆叠注入</h6><p>第一种方式更加切题，我们先从第一种，通过布尔盲注的方式来</p>
<h5 id="解法一、使用布尔盲注"><a href="#解法一、使用布尔盲注" class="headerlink" title="解法一、使用布尔盲注"></a>解法一、使用布尔盲注</h5><p>在讲解题之前要先提一下一个函数 —- substring，作用是截取字符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">substring</span>(string ,<span class="number">1</span>,<span class="number">3</span>) <span class="operator">/</span><span class="operator">/</span> 取string左边第<span class="number">1</span>位置起，<span class="number">3</span>字长的字符串。</span><br><span class="line"><span class="operator">=</span><span class="operator">=</span>》 输出结果为：str</span><br></pre></td></tr></table></figure>


<p>基本思路是先爆表，再爆库，再爆列，再爆值。毕竟是盲注嘛，还是很累的。这里列举一下爆表&#x2F;库&#x2F;列的 payload：</p>
<blockquote>
<p>爆表名：<br>1’ or substring((select schema_name from information_schema.schemata limit 0, 1), 1, 1)&#x3D;’I’;–</p>
</blockquote>
<ul>
<li>需要改动 substring 的数值，例如，爆出第一位之后，需要改变payload 为 substring(语句,2,1) 用来爆破第二位。爆破可以使用 burpsuite</li>
</ul>


<p>爆破的结果：</p>


<p>由此可以看出，schema 名的第一个字母为 C，接着继续爆…………以此类推</p>
<blockquote>
<p>爆库<br>‘ or substring((select table_name from information_schema.tables where table_schema&#x3D;’刚获取到的表名’ limit 0, 1), 1, 1)&#x3D;’a’;–</p>
</blockquote>
<blockquote>
<p>爆列<br>‘ or substring((select column_name from information_schema.columns where table_name&#x3D;’刚获取到的table名’ limit 0, 1), 1, 1)&#x3D;’a’;–</p>
</blockquote>
<p>这里直接猜测列的名字是 password，构造 payload：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tom<span class="string">&#x27; or password=&#x27;</span><span class="number">12345</span> <span class="operator">/</span><span class="operator">/</span>用这个语句，判断 password 列对应的是密码</span><br></pre></td></tr></table></figure>

<ul>
<li>当我们已经爆出列的时候，就可以开始爆密码了。</li>
</ul>
<p>payload：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tom<span class="string">&#x27; and substring(password,1,1)=&#x27;</span>a <span class="operator">/</span><span class="operator">/</span> 爆密码的第一位</span><br></pre></td></tr></table></figure>

<p>第一位字母的爆破如图</p>



<p>对于 tom’ 来说，只有 <code>tom and true</code>时才会是 True，否则会报错，也就是说，只有爆对字母才会成功 ~</p>
<p>最后得出 tom 的密码是 <strong><code>thisisasecretfortomonly</code></strong></p>
<h5 id="解法二、使用堆叠注入"><a href="#解法二、使用堆叠注入" class="headerlink" title="解法二、使用堆叠注入"></a>解法二、使用堆叠注入</h5><p>爆表，爆库，爆列的几步走和上面一致</p>
<p>只是在篡改密码时的 payload 不同了</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;; update XXX_TABLE set PASSWORD_COLUMN = &#x27;</span><span class="number">123456</span><span class="string">&#x27;; --</span></span><br></pre></td></tr></table></figure>
<p>然后以用户名tom和密码123456登录即可。</p>
<h2 id="0x03-SQL-注入的基本防御手段"><a href="#0x03-SQL-注入的基本防御手段" class="headerlink" title="0x03 SQL 注入的基本防御手段"></a>0x03 SQL 注入的基本防御手段</h2><h3 id="1-构造不可变的查询"><a href="#1-构造不可变的查询" class="headerlink" title="1. 构造不可变的查询"></a>1. 构造不可变的查询</h3><h4 id="1-1-静态查询"><a href="#1-1-静态查询" class="headerlink" title="1.1 静态查询"></a>1.1 静态查询</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> <span class="keyword">user</span> <span class="operator">=</span> &quot;&#x27;&quot; <span class="operator">+</span> session.getAttribute(&quot;UserID&quot;) <span class="operator">+</span> &quot;&#x27;&quot;;</span><br></pre></td></tr></table></figure>

<p>这里的 UserID 就不经过拼接，而是直接通过 session.getAttribute 读取。</p>
<h4 id="1-2-预编译-————-也就是使用问号"><a href="#1-2-预编译-————-也就是使用问号" class="headerlink" title="1.2 预编译 ———— 也就是使用问号"></a>1.2 预编译 ———— 也就是使用问号</h4><ul>
<li>预编译的问题在上文我们也提到过 ~</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String query <span class="operator">=</span> &quot;SELECT * FROM users WHERE last_name = ?&quot;;</span><br><span class="line">PreparedStatement statement <span class="operator">=</span> connection.prepareStatement(query);</span><br><span class="line">statement.setString(<span class="number">1</span>, accountName);</span><br><span class="line">ResultSet results <span class="operator">=</span> statement.executeQuery();</span><br></pre></td></tr></table></figure>

<p>很多小伙伴们觉得预编译可以完美防止 SQL 注入，其实不完全是这样的。</p>
<h3 id="2-使用转义字符"><a href="#2-使用转义字符" class="headerlink" title="2. 使用转义字符"></a>2. 使用转义字符</h3><p>转义字符，也就是过滤掉一些特殊的字符，比如单引号、括号这种，能够很好的防御 SQL 注入。</p>
<h3 id="3-对访问数据库的-Web-应用程序进行-WAF-操作。"><a href="#3-对访问数据库的-Web-应用程序进行-WAF-操作。" class="headerlink" title="3.对访问数据库的 Web 应用程序进行 WAF 操作。"></a>3.对访问数据库的 Web 应用程序进行 WAF 操作。</h3>
            </div>

            
                <div class="post-copyright-info">
                    
<div class="article-copyright-info-container">
    <ul class="copyright-info-content">
        <li class="post-title">
            <span class="type">本文标题</span>：<span class="content">WebGoat代码审计-02-SQL注入</span>
        </li>
        <li class="post-author">
            <span class="type">本文作者</span>：<span class="content">Drunkbaby</span>
        </li>
        <li class="post-time">
            <span class="type">创建时间</span>：<span class="content">2022-03-17 13:13:51</span>
        </li>
        <li class="post-link">
            <span class="type">本文链接</span>：<span class="content">2022/03/17/WebGoat代码审计-02-SQL注入/</span>
        </li>
        <li class="post-license">
            <span class="type">版权声明</span>：<span class="content">本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！</span>
        </li>
    </ul>
    <div class="copy-copyright-info flex-center tooltip" data-content="复制版权信息" data-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"><i class="icon fas fa-hashtag"></i>代码审计</a>&nbsp;
                        </li>
                    
                </ul>
            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                               rel="prev"
                               href="/2022/03/22/%E4%BB%8E0%E5%88%B01%E5%AE%8C%E5%85%A8%E6%8E%8C%E6%8F%A1-SQL-%E6%B3%A8%E5%85%A5/"
                            >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                                <span class="title flex-center">
                                <span class="post-nav-title-item text-ellipsis">从0到1完全掌握 SQL 注入</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                               rel="next"
                               href="/2022/03/14/WebGoat%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-01-%E5%9F%BA%E7%A1%80General/"
                            >
                            <span class="title flex-center">
                                <span class="post-nav-title-item text-ellipsis">WebGoat代码审计-01-基础General</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                                <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                            </a>
                        </div>
                    
                </div>
            

            
                


    <div class="comments-container">
        <div id="comments-anchor"></div>
        <div class="comment-area-title">
            <i class="fas fa-comments"></i>&nbsp;评论
        </div>
        
            

    <div class="valine-container">
        <script data-pjax src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
          function loadValine() {

            const config = {
              el: '#vcomments',
              appId: 'mCIu9X4iLP3I0GikUoetB9bV-9Nh9j0Va',
              appKey: 'ermlV1eoB1YODT088EdXjo6C',
              meta: ['nick', 'mail', 'link'],
              avatar: 'wavatar',
              enableQQ: true,
              placeholder: 'just go go',
              lang: 'zh-CN'.toLowerCase()
            }

            if ('') {
              config.serverURLs = ''
            }

            new Valine(config)

            function getAuthor(language) {
              switch (language) {
                case 'en':
                  return 'Author'
                case 'zh-CN':
                  return '博主'
                case 'zh-TW':
                  return '站長'
                default:
                  return 'Master'
              }
            }

            // Add "Author" identify
            const getValineDomTimer = setInterval(() => {
              const vcards = document.querySelectorAll('#vcomments .vcards .vcard')
              if (vcards.length > 0) {
                let author = 'Drunkbaby'

                if (author) {
                  for (let vcard of vcards) {
                    const vnick_dom = vcard.querySelector('.vhead .vnick')
                    const vnick = vnick_dom.innerHTML
                    if (vnick === author) {
                      vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                    }
                  }
                }
                clearInterval(getValineDomTimer)
              } else {
                clearInterval(getValineDomTimer)
              }
            }, 2000)
          }

          if ('true' === 'true') {
            const loadValineTimeout = setTimeout(() => {
              loadValine()
              clearTimeout(loadValineTimeout)
            }, 1000)
          } else {
            window.addEventListener('DOMContentLoaded', loadValine)
          }
        </script>
    </div>


        
    </div>





            
        </div>

        
            <div class="pc-post-toc right-toc">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#WebGoat-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-02-SQL-%E6%B3%A8%E5%85%A5"><span class="nav-text">WebGoat 代码审计-02-SQL 注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-SQL-Injection-intro"><span class="nav-text">0x01 SQL Injection (intro)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-SQL-Injection-intro-PageLesson2-select"><span class="nav-text">1. SQL Injection (intro) PageLesson2 select</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-SQL-Injection-intro-PageLesson3-update"><span class="nav-text">2. SQL Injection (intro) PageLesson3 update</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-SQL-Injection-intro-PageLesson4-alter"><span class="nav-text">3. SQL Injection (intro) PageLesson4 alter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-SQL-Injection-intro-PageLesson5-grant"><span class="nav-text">4. SQL Injection (intro) PageLesson5 grant</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-SQL-Injection-intro-PageLesson9-%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81"><span class="nav-text">5. SQL Injection (intro) PageLesson9 万能密码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-SQL-Injection-intro-PageLesson10-%E6%95%B0%E5%AD%97%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="nav-text">6. SQL Injection (intro) PageLesson10 数字型注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%95%B0%E5%AD%97%E5%9E%8B%E6%B3%A8%E5%85%A5%E7%9A%84%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="nav-text">测试数字型注入的步骤：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%8A%A0%E5%8D%95%E5%BC%95%E5%8F%B7%EF%BC%8Cid-x3D-3%E2%80%99"><span class="nav-text">(1) 加单引号，id&#x3D;3’</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E5%8A%A0-and-1-x3D-1%EF%BC%8Cid-x3D-3-and-1-x3D-1"><span class="nav-text">(2) 加 and 1&#x3D;1，id&#x3D;3 and 1&#x3D;1</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E5%8A%A0and-1-x3D-2%EF%BC%8Cid-x3D-3-and-1-x3D-2"><span class="nav-text">(3) 加and 1&#x3D;2，id&#x3D;3 and 1&#x3D;2</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-SQL-Injection-intro-PageLesson11-%E5%AD%97%E7%AC%A6%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="nav-text">7. SQL Injection (intro) PageLesson11 字符型注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E5%AD%97%E7%AC%A6%E5%9E%8B%E6%B3%A8%E5%85%A5%E7%9A%84%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="nav-text">测试字符型注入的步骤：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%8A%A0%E5%8D%95%E5%BC%95%E5%8F%B7%EF%BC%8Cid-x3D-3%E2%80%99-and-password-x3D-123"><span class="nav-text">(1) 加单引号，id&#x3D;3’ and password&#x3D;123</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E5%B0%9D%E8%AF%95%E7%BB%95%E8%BF%87%EF%BC%8C%E9%80%9A%E8%BF%87-1%E2%80%99-or-%E2%80%981%E2%80%99-x3D-%E2%80%991"><span class="nav-text">(2) 尝试绕过，通过 1’ or ‘1’&#x3D;’1</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-SQL-Injection-intro-PageLesson12-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="nav-text">8. SQL Injection (intro) PageLesson12 堆叠注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-SQL-Injection-intro-PageLesson13-%E5%B9%B2%E5%AE%8C%E5%9D%8F%E4%BA%8B%E8%AE%B0%E5%BE%97%E5%88%A0%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%EF%BC%81"><span class="nav-text">9. SQL Injection (intro) PageLesson13 干完坏事记得删历史记录！</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x02-SQL-Injection-advanced"><span class="nav-text">0x02 SQL Injection (advanced)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5%E5%89%8D%E7%9A%84-Preparation"><span class="nav-text">1. 联合注入前的 Preparation</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Prepare%E2%91%A0-SQL-%E8%AF%AD%E5%8F%A5%E5%BD%93%E4%B8%AD%E7%9A%84%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7"><span class="nav-text">Prepare① : SQL 语句当中的特殊符号</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%B8%B8%E8%A7%81%E6%B3%A8%E9%87%8A%E7%AC%A6%EF%BC%9A"><span class="nav-text">(1) 常见注释符：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E5%B8%B8%E8%A7%81%E6%9F%A5%E8%AF%A2%E7%AC%A6%EF%BC%9A"><span class="nav-text">(2) 常见查询符：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E5%B8%B8%E8%A7%81%E8%BF%9E%E6%8E%A5%E7%AC%A6%EF%BC%9A"><span class="nav-text">(3) 常见连接符：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Prepare%E2%91%A1-SQL-UNION-SELECT-%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="nav-text">Prepare②: SQL UNION SELECT 联合查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Prepare%E2%91%A2-SQL-UNION-SELECT-%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><span class="nav-text">Prepare③: SQL UNION SELECT 的两个前提条件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E4%B8%80%E3%80%81-SELECT-%E7%9A%84%E5%88%97%E6%95%B0%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%88%97%E6%95%B0%E7%9B%B8%E7%AD%89%EF%BC%9A"><span class="nav-text">条件一、 SELECT 的列数与数据库的列数相等：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E4%BA%8C%E3%80%81-%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%95%B0%E6%8D%AE%E8%A6%81%E4%B8%8E%E5%8E%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%97%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8C%B9%E9%85%8D"><span class="nav-text">条件二、 查询的数据要与原数据库列的数据类型匹配</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Solution1-%E9%80%9A%E8%BF%87-ORDER-BY-%E5%91%BD%E4%BB%A4"><span class="nav-text">Solution1 通过 ORDER BY 命令</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Solution2-%E9%80%9A%E8%BF%87-UNION-SELECT-NULL-%E6%9D%A5%E5%88%A4%E6%96%AD%E5%88%97%E6%95%B0"><span class="nav-text">Solution2 通过 UNION SELECT NULL 来判断列数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-SQL-Injection-advanced-PageLesson3"><span class="nav-text">2. SQL Injection (advanced) PageLesson3</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80%E3%80%81%E4%BD%BF%E7%94%A8%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="nav-text">解法一、使用堆叠注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C%E3%80%81%E4%BD%BF%E7%94%A8%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="nav-text">解法二、使用联合注入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-SQL-%E7%9B%B2%E6%B3%A8"><span class="nav-text">3. SQL 盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF-SQL-%E7%9B%B2%E6%B3%A8"><span class="nav-text">(1) 什么是 SQL 盲注</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%88%A4%E6%96%AD-SQL-%E7%9B%B2%E6%B3%A8%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-text">(2) 判断 SQL 盲注的方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E9%92%88%E5%AF%B9%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF-True-%E4%B8%8E-False-%E7%9A%84%E5%9B%9E%E6%98%BE"><span class="nav-text">1. 针对布尔盲注，也就是 True 与 False 的回显</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8%E5%88%A4%E6%96%AD%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="nav-text">布尔盲注判断方法：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8%E5%88%A4%E6%96%AD%E6%96%B9%E6%B3%95"><span class="nav-text">时间盲注判断方法</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-SQL-Injection-advanced-PageLesson5-%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="nav-text">4. SQL Injection (advanced) PageLesson5 布尔盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%8E%A2%E6%B5%8B%E6%B3%A8%E5%85%A5%E7%82%B9"><span class="nav-text">(1) 探测注入点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8-x2F-%E7%90%86%E8%A7%A3%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="nav-text">(2) 进阶使用&#x2F;理解布尔盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A6%82%E6%9E%9C%E6%83%B3%E8%A6%81%E4%BB%A5-tom-%E7%9A%84%E8%BA%AB%E4%BB%BD%E7%99%BB%E5%BD%95%E6%97%A0%E9%9D%9E%E6%98%AF%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="nav-text">如果想要以 tom 的身份登录无非是两种方式</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E9%80%9A%E8%BF%87%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5%E7%88%86%E5%87%BA-tom-%E7%9A%84%E6%95%B0%E6%8D%AE-%E2%80%94%E2%80%94%E2%80%94%E2%80%94-%E4%BD%BF%E7%94%A8%E5%88%B0%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="nav-text">一、通过联合注入爆出 tom 的数据 ———— 使用到布尔盲注</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E7%AF%A1%E6%94%B9-tom-%E7%9A%84%E5%AF%86%E7%A0%81-%E2%80%94%E2%80%94%E2%80%94-%E8%BF%90%E7%94%A8%E6%88%91%E4%BB%AC%E4%B9%8B%E5%89%8D%E6%89%80%E8%AE%B2%E7%9A%84%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="nav-text">二、篡改 tom 的密码 ——— 运用我们之前所讲的堆叠注入</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80%E3%80%81%E4%BD%BF%E7%94%A8%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="nav-text">解法一、使用布尔盲注</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C%E3%80%81%E4%BD%BF%E7%94%A8%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="nav-text">解法二、使用堆叠注入</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x03-SQL-%E6%B3%A8%E5%85%A5%E7%9A%84%E5%9F%BA%E6%9C%AC%E9%98%B2%E5%BE%A1%E6%89%8B%E6%AE%B5"><span class="nav-text">0x03 SQL 注入的基本防御手段</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%9E%84%E9%80%A0%E4%B8%8D%E5%8F%AF%E5%8F%98%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="nav-text">1. 构造不可变的查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-%E9%9D%99%E6%80%81%E6%9F%A5%E8%AF%A2"><span class="nav-text">1.1 静态查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-%E9%A2%84%E7%BC%96%E8%AF%91-%E2%80%94%E2%80%94%E2%80%94%E2%80%94-%E4%B9%9F%E5%B0%B1%E6%98%AF%E4%BD%BF%E7%94%A8%E9%97%AE%E5%8F%B7"><span class="nav-text">1.2 预编译 ———— 也就是使用问号</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E4%BD%BF%E7%94%A8%E8%BD%AC%E4%B9%89%E5%AD%97%E7%AC%A6"><span class="nav-text">2. 使用转义字符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%AF%B9%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84-Web-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%BF%9B%E8%A1%8C-WAF-%E6%93%8D%E4%BD%9C%E3%80%82"><span class="nav-text">3.对访问数据库的 Web 应用程序进行 WAF 操作。</span></a></li></ol></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="border-box website-info-box default">
        
            <div class="copyright-info info-item default">
                &copy;&nbsp;<span>2021</span>&nbsp;-&nbsp;2023
                
                    &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">Drunkbaby</a>
                
            </div>

            <div class="theme-info info-item default">
                由&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.7.3</a>
            </div>

            

            
        

        <div class="count-item info-item default">
            

            
                <span class="count-box border-box uv">
                    <span class="item-type border-box">访问人数</span>
                    <span class="item-value border-box uv" id="busuanzi_value_site_uv"></span>
                </span>
            

            
                <span class="count-box border-box pv">
                    <span class="item-type border-box">总访问量</span>
                    <span class="item-value border-box pv" id="busuanzi_value_site_pv"></span>
                </span>
            
        </div>
    </div>
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="tools-list border-box">
        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        
            <li class="tools-item flex-center go-to-comments">
                <i class="fas fa-comment"></i>
                <span class="post-comments-count"></span>
            </li>
        
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        
            <li class="tools-item go-to-comments-tablet flex-center">
                <i class="fas fa-comment"></i>
            </li>
        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#WebGoat-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-02-SQL-%E6%B3%A8%E5%85%A5"><span class="nav-text">WebGoat 代码审计-02-SQL 注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-SQL-Injection-intro"><span class="nav-text">0x01 SQL Injection (intro)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-SQL-Injection-intro-PageLesson2-select"><span class="nav-text">1. SQL Injection (intro) PageLesson2 select</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-SQL-Injection-intro-PageLesson3-update"><span class="nav-text">2. SQL Injection (intro) PageLesson3 update</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-SQL-Injection-intro-PageLesson4-alter"><span class="nav-text">3. SQL Injection (intro) PageLesson4 alter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-SQL-Injection-intro-PageLesson5-grant"><span class="nav-text">4. SQL Injection (intro) PageLesson5 grant</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-SQL-Injection-intro-PageLesson9-%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81"><span class="nav-text">5. SQL Injection (intro) PageLesson9 万能密码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-SQL-Injection-intro-PageLesson10-%E6%95%B0%E5%AD%97%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="nav-text">6. SQL Injection (intro) PageLesson10 数字型注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%95%B0%E5%AD%97%E5%9E%8B%E6%B3%A8%E5%85%A5%E7%9A%84%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="nav-text">测试数字型注入的步骤：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%8A%A0%E5%8D%95%E5%BC%95%E5%8F%B7%EF%BC%8Cid-x3D-3%E2%80%99"><span class="nav-text">(1) 加单引号，id&#x3D;3’</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E5%8A%A0-and-1-x3D-1%EF%BC%8Cid-x3D-3-and-1-x3D-1"><span class="nav-text">(2) 加 and 1&#x3D;1，id&#x3D;3 and 1&#x3D;1</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E5%8A%A0and-1-x3D-2%EF%BC%8Cid-x3D-3-and-1-x3D-2"><span class="nav-text">(3) 加and 1&#x3D;2，id&#x3D;3 and 1&#x3D;2</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-SQL-Injection-intro-PageLesson11-%E5%AD%97%E7%AC%A6%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="nav-text">7. SQL Injection (intro) PageLesson11 字符型注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E5%AD%97%E7%AC%A6%E5%9E%8B%E6%B3%A8%E5%85%A5%E7%9A%84%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="nav-text">测试字符型注入的步骤：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%8A%A0%E5%8D%95%E5%BC%95%E5%8F%B7%EF%BC%8Cid-x3D-3%E2%80%99-and-password-x3D-123"><span class="nav-text">(1) 加单引号，id&#x3D;3’ and password&#x3D;123</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E5%B0%9D%E8%AF%95%E7%BB%95%E8%BF%87%EF%BC%8C%E9%80%9A%E8%BF%87-1%E2%80%99-or-%E2%80%981%E2%80%99-x3D-%E2%80%991"><span class="nav-text">(2) 尝试绕过，通过 1’ or ‘1’&#x3D;’1</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-SQL-Injection-intro-PageLesson12-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="nav-text">8. SQL Injection (intro) PageLesson12 堆叠注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-SQL-Injection-intro-PageLesson13-%E5%B9%B2%E5%AE%8C%E5%9D%8F%E4%BA%8B%E8%AE%B0%E5%BE%97%E5%88%A0%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%EF%BC%81"><span class="nav-text">9. SQL Injection (intro) PageLesson13 干完坏事记得删历史记录！</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x02-SQL-Injection-advanced"><span class="nav-text">0x02 SQL Injection (advanced)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5%E5%89%8D%E7%9A%84-Preparation"><span class="nav-text">1. 联合注入前的 Preparation</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Prepare%E2%91%A0-SQL-%E8%AF%AD%E5%8F%A5%E5%BD%93%E4%B8%AD%E7%9A%84%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7"><span class="nav-text">Prepare① : SQL 语句当中的特殊符号</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%B8%B8%E8%A7%81%E6%B3%A8%E9%87%8A%E7%AC%A6%EF%BC%9A"><span class="nav-text">(1) 常见注释符：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E5%B8%B8%E8%A7%81%E6%9F%A5%E8%AF%A2%E7%AC%A6%EF%BC%9A"><span class="nav-text">(2) 常见查询符：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E5%B8%B8%E8%A7%81%E8%BF%9E%E6%8E%A5%E7%AC%A6%EF%BC%9A"><span class="nav-text">(3) 常见连接符：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Prepare%E2%91%A1-SQL-UNION-SELECT-%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="nav-text">Prepare②: SQL UNION SELECT 联合查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Prepare%E2%91%A2-SQL-UNION-SELECT-%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><span class="nav-text">Prepare③: SQL UNION SELECT 的两个前提条件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E4%B8%80%E3%80%81-SELECT-%E7%9A%84%E5%88%97%E6%95%B0%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%88%97%E6%95%B0%E7%9B%B8%E7%AD%89%EF%BC%9A"><span class="nav-text">条件一、 SELECT 的列数与数据库的列数相等：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E4%BA%8C%E3%80%81-%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%95%B0%E6%8D%AE%E8%A6%81%E4%B8%8E%E5%8E%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%97%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8C%B9%E9%85%8D"><span class="nav-text">条件二、 查询的数据要与原数据库列的数据类型匹配</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Solution1-%E9%80%9A%E8%BF%87-ORDER-BY-%E5%91%BD%E4%BB%A4"><span class="nav-text">Solution1 通过 ORDER BY 命令</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Solution2-%E9%80%9A%E8%BF%87-UNION-SELECT-NULL-%E6%9D%A5%E5%88%A4%E6%96%AD%E5%88%97%E6%95%B0"><span class="nav-text">Solution2 通过 UNION SELECT NULL 来判断列数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-SQL-Injection-advanced-PageLesson3"><span class="nav-text">2. SQL Injection (advanced) PageLesson3</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80%E3%80%81%E4%BD%BF%E7%94%A8%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="nav-text">解法一、使用堆叠注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C%E3%80%81%E4%BD%BF%E7%94%A8%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="nav-text">解法二、使用联合注入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-SQL-%E7%9B%B2%E6%B3%A8"><span class="nav-text">3. SQL 盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF-SQL-%E7%9B%B2%E6%B3%A8"><span class="nav-text">(1) 什么是 SQL 盲注</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%88%A4%E6%96%AD-SQL-%E7%9B%B2%E6%B3%A8%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-text">(2) 判断 SQL 盲注的方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E9%92%88%E5%AF%B9%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF-True-%E4%B8%8E-False-%E7%9A%84%E5%9B%9E%E6%98%BE"><span class="nav-text">1. 针对布尔盲注，也就是 True 与 False 的回显</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8%E5%88%A4%E6%96%AD%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="nav-text">布尔盲注判断方法：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8%E5%88%A4%E6%96%AD%E6%96%B9%E6%B3%95"><span class="nav-text">时间盲注判断方法</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-SQL-Injection-advanced-PageLesson5-%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="nav-text">4. SQL Injection (advanced) PageLesson5 布尔盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%8E%A2%E6%B5%8B%E6%B3%A8%E5%85%A5%E7%82%B9"><span class="nav-text">(1) 探测注入点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8-x2F-%E7%90%86%E8%A7%A3%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="nav-text">(2) 进阶使用&#x2F;理解布尔盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A6%82%E6%9E%9C%E6%83%B3%E8%A6%81%E4%BB%A5-tom-%E7%9A%84%E8%BA%AB%E4%BB%BD%E7%99%BB%E5%BD%95%E6%97%A0%E9%9D%9E%E6%98%AF%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="nav-text">如果想要以 tom 的身份登录无非是两种方式</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E9%80%9A%E8%BF%87%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5%E7%88%86%E5%87%BA-tom-%E7%9A%84%E6%95%B0%E6%8D%AE-%E2%80%94%E2%80%94%E2%80%94%E2%80%94-%E4%BD%BF%E7%94%A8%E5%88%B0%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="nav-text">一、通过联合注入爆出 tom 的数据 ———— 使用到布尔盲注</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E7%AF%A1%E6%94%B9-tom-%E7%9A%84%E5%AF%86%E7%A0%81-%E2%80%94%E2%80%94%E2%80%94-%E8%BF%90%E7%94%A8%E6%88%91%E4%BB%AC%E4%B9%8B%E5%89%8D%E6%89%80%E8%AE%B2%E7%9A%84%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="nav-text">二、篡改 tom 的密码 ——— 运用我们之前所讲的堆叠注入</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80%E3%80%81%E4%BD%BF%E7%94%A8%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="nav-text">解法一、使用布尔盲注</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C%E3%80%81%E4%BD%BF%E7%94%A8%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="nav-text">解法二、使用堆叠注入</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x03-SQL-%E6%B3%A8%E5%85%A5%E7%9A%84%E5%9F%BA%E6%9C%AC%E9%98%B2%E5%BE%A1%E6%89%8B%E6%AE%B5"><span class="nav-text">0x03 SQL 注入的基本防御手段</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%9E%84%E9%80%A0%E4%B8%8D%E5%8F%AF%E5%8F%98%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="nav-text">1. 构造不可变的查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-%E9%9D%99%E6%80%81%E6%9F%A5%E8%AF%A2"><span class="nav-text">1.1 静态查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-%E9%A2%84%E7%BC%96%E8%AF%91-%E2%80%94%E2%80%94%E2%80%94%E2%80%94-%E4%B9%9F%E5%B0%B1%E6%98%AF%E4%BD%BF%E7%94%A8%E9%97%AE%E5%8F%B7"><span class="nav-text">1.2 预编译 ———— 也就是使用问号</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E4%BD%BF%E7%94%A8%E8%BD%AC%E4%B9%89%E5%AD%97%E7%AC%A6"><span class="nav-text">2. 使用转义字符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%AF%B9%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84-Web-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%BF%9B%E8%A1%8C-WAF-%E6%93%8D%E4%BD%9C%E3%80%82"><span class="nav-text">3.对访问数据库的 Web 应用程序进行 WAF 操作。</span></a></li></ol></li></ol></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/dark-light-toggle.js"></script>




    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/code-block.js"></script>




<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/post-helper.js"></script>
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/libs/anime.min.js"></script>
        
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/toc.js"></script>
        
    
    
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.7.3/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>




</body>
</html>
